<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="author" content="Jose Abell">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>Finite Elements for Shallow Water&nbsp;Equations | Jose Abell's Research Blog</title>

        <link rel="alternate" type="application/atom+xml" title="Jose Abell's Research Blog blog atom feed" href="/feeds/all.atom.xml" />
        <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
        <link rel="stylesheet" href="/theme/css/pygments.css">
        <link rel="stylesheet" href="/theme/css/main.css">


    </head>

    <body>
        <header class="main-header" style="background: url('/images/header.png') no-repeat center center #DDD; background-size: 100%;">
        <h1 id="title"> Jos√© Abell's research blog</h1>
        <hr>
        <nav>
            <div class="container">
            <ul>
                <li><a href="/" title="Home">Home</a></li>
            </ul>
            </div>
        </nav>
        </header>

<div class="container post">

    <article>
        <header>
            <h1>Finite Elements for Shallow Water&nbsp;Equations</h1>
            <time datetime="article.date.isoformat()" pubdate>Tue 22 November 2016</time>
        </header>

        <div class="article_content">
            <div class="youtube" align="left">
<iframe width="640" height="480" src="https://www.youtube.com/embed/ghdvW-2XzKA" frameborder="0" allowfullscreen></iframe>
</div>

<p>The linear <a href="https://en.wikipedia.org/wiki/Shallow_water_equations">shallow water equations</a> (<span class="caps">SWE</span>) are used extensively to model propagation of waves in situations where lateral domain dimensions are much greater than fluid height and, at the same time, wave perturbation height are much smaller than the fluid height. This finds useful applications in the case of tsunami-wave propagation modeling in deep-sea. The equations, after heavy linearization, are given&nbsp;by:</p>
<p>$$\begin{aligned}
\pardiff{u}{t} -  f v = -g \pardiff{h}{x} \ 
\pardiff{v}{t} +  f v = -g \pardiff{h}{y} \
\pardiff{h}{t} = -H \pare{  \pardiff{u}{x} + \pardiff{v}{y}&nbsp;}\end{aligned}$$</p>
<p>Where</p>
<ul>
<li>
<p>$u$ is the speed in $x$&nbsp;direction.</p>
</li>
<li>
<p>$v$ is the speed in $y$&nbsp;direction.</p>
</li>
<li>
<p>$h$ wave perturbation height. (Free surface is at&nbsp;$h+H$)</p>
</li>
<li>
<p>$f$ Coriolis force, given&nbsp;by:</p>
<p>$$\begin{aligned}
    f = 2 \Omega \sin \phi&nbsp;\end{aligned}$$</p>
<p>where $\Omega$ is Earth&#8217;s angular velocity ($\pi/12 \, \brak{\mathrm{rad/h}}$) and $\phi$ is&nbsp;latitude. </p>
</li>
<li>
<p>$g$ acceleration due to gravity at given point in&nbsp;Earth.</p>
</li>
<li>
<p>$H$ fluid free surface height at&nbsp;repose. </p>
</li>
</ul>
<p>To complete the formulation, appropriate boundary conditions are&nbsp;needed. </p>
<p>These equations will be discretized using Galerkin finite-element formulation. For this purpose we will be using the first order triangle finite element (see Felippa&#8217;s chapter 15 <a href="http://www.colorado.edu/engineering/CAS/courses.d/IFEM.d/IFEM.Ch15.d/IFEM.Ch15.index.html">here</a> for basic notation and details regarding triangular shape&nbsp;functions).</p>
<p>The <span class="caps">SWE</span> represent the space-time evolution of three scalar fields, namely $h$, $u$, and $v$. These three independent variables are the 3 degrees-of-freedom (<span class="caps">DOF</span>) of the problem. Therefore, each node will have information about these three&nbsp;DOFs. </p>
<p>Using the basic 3-node triangle with interpolation functions given by the triangular coordinates (see Felippa <span class="caps">IFEM</span> Ch. 15 and <a href="https://en.wikipedia.org/wiki/Barycentric_coordinate_system">this</a> for more info), these fields are interpolated as&nbsp;follows.</p>
<p>$$\begin{aligned}
h = \sum N_i h_i = \vect{N} \vect{h} = \matorvec{ccc}{ \zeta_1 <span class="amp">&amp;</span> \zeta_2 <span class="amp">&amp;</span> \zeta_3 } \matorvec{c}{h_1\h_2\h_3}  \ 
u = \sum N_i u_i = \vect{N} \vect{u} = \matorvec{ccc}{ \zeta_1 <span class="amp">&amp;</span> \zeta_2 <span class="amp">&amp;</span> \zeta_3 } \matorvec{c}{u_1\u_2\u_3} \
v = \sum N_i v_i = \vect{N} \vect{v} = \matorvec{ccc}{ \zeta_1 <span class="amp">&amp;</span> \zeta_2 <span class="amp">&amp;</span> \zeta_3 } \matorvec{c}{v_1\v_2\v_3}&nbsp;\end{aligned}$$</p>
<p>Where $\zeta_i$ are triangular coordinates and $u_i$, $v_i$, and
$h_i$ the nodal values of the scalar fields at node&nbsp;$i$.</p>
<p>As typical, we multiply the equations by a trial shape function $N_j$ and integrate over the domain of the element $\Omega^e$, carrying out integration by parts. We arrive at the weak form of the <span class="caps">SWE</span>. </p>
<p>$$\begin{aligned}
\pare{ \int_{\Omega^e}  N_i N_j \ud \Omega^e} \dot{h}<em _Omega_e="\Omega^e">j - 
\pare{ \int</em>  H \pardiff{N_i}{x} N_j \ud \Omega^e} u_j -
\pare{ \int_{\Omega^e}  H \pardiff{N_i}{y} N_j \ud \Omega^e} v_j = 0 \
\pare{ \int_{\Omega^e}  N_i N_j \ud \Omega^e} \dot{u}<em _Omega_e="\Omega^e">j -
\pare{ \int</em>  f N_i N_j \ud \Omega^e} v_j + 
\pare{ \int_{\Omega^e}  g N_i \pardiff{N_j}{x}  \ud \Omega^e} h_j = 0 \
\pare{ \int_{\Omega^e}  N_i N_j \ud \Omega^e} \dot{v}<em _Omega_e="\Omega^e">j +
\pare{ \int</em>  f N_i N_j \ud \Omega^e} u_j + 
\pare{ \int_{\Omega^e}  g N_i \pardiff{N_j}{y}  \ud \Omega^e} h_j = 0&nbsp;\end{aligned}$$</p>
<p>Here, for the first order triangle, we simply have that 1 $N_i = \zeta_i$. Defining the vector of nodal freedoms $\vect{z}$&nbsp;as:</p>
<p>$$\begin{aligned}
\vect{z}^T = \matorvec{ccccccccc}{h_1 <span class="amp">&amp;</span> h_2 <span class="amp">&amp;</span> h_3 <span class="amp">&amp;</span> u_1 <span class="amp">&amp;</span> u_2 <span class="amp">&amp;</span> u_3 <span class="amp">&amp;</span> v_1 <span class="amp">&amp;</span> v_2 <span class="amp">&amp;</span> v_3&nbsp;}^T\end{aligned}$$</p>
<p>The above equations can be re-written as&nbsp;follows:</p>
<p>$$\begin{aligned}
\matorvec{ccc}
{
    \vect{M} <span class="amp">&amp;</span> \vect{0} <span class="amp">&amp;</span> \vect{0} \
    \vect{0} <span class="amp">&amp;</span> \vect{M} <span class="amp">&amp;</span> \vect{0} \
    \vect{0} <span class="amp">&amp;</span> \vect{0} <span class="amp">&amp;</span> \vect{M} 
} \dot{\vect{z}}  + 
\matorvec{ccc}
{
    \vect{0}        <span class="amp">&amp;</span> -\vect{K}<em hv>{hu} <span class="amp">&amp;</span> -\vect{K}</em> \
    \vect{K}<em uv>{uh}   <span class="amp">&amp;</span> \vect{0} <span class="amp">&amp;</span> -\vect{K}</em> \
    \vect{K}<em vu>{vh}   <span class="amp">&amp;</span> \vect{K}</em> <span class="amp">&amp;</span> \vect{0} 
} \vect{z}
=
\matorvec{c}
{
    \vect{0} \ \vect{0} \ \vect{0}
} \ 
\vect{A} \dot{\vect{z}} + \vect{B}  \vect{z} =&nbsp;\vect{0}\end{aligned}$$</p>
<p>Where the involved sub-matrices are given by the following matrix&nbsp;integrals:</p>
<p>$$\begin{aligned}
     <span class="amp">&amp;</span> \vect{M} = \int_{\Omega^e} \vect{N}^T \vect{N} \ud \Omega^e \
     <span class="amp">&amp;</span> \vect{K}<em _Omega_e="\Omega^e">{hu} = \int</em> H \pare{\pardiff{\vect{N}}{x}}^T \vect{N}  \ud \Omega^e \
     <span class="amp">&amp;</span> \vect{K}<em _Omega_e="\Omega^e">{hv} = \int</em> H \pare{\pardiff{\vect{N}}{y}}^T \vect{N}  \ud \Omega^e \
     <span class="amp">&amp;</span> \vect{K}<em _Omega_e="\Omega^e">{uh} = \int</em> g \vect{N}^T \pardiff{\vect{N}}{x} \ud \Omega^e \
     <span class="amp">&amp;</span> \vect{K}<em _Omega_e="\Omega^e">{vh} = \int</em> g \vect{N}^T \pardiff{\vect{N}}{y} \ud \Omega^e \
     <span class="amp">&amp;</span> \vect{K}<em _Omega_e="\Omega^e">{uv} = \int</em> f \vect{N}^T \vect{N} \ud \Omega^e \
     <span class="amp">&amp;</span> \vect{K}<em _Omega_e="\Omega^e">{vu} = \int</em> f \vect{N}^T \vect{N} \ud \Omega^e&nbsp;\end{aligned}$$</p>
<p>The derivatives $\pardiff{\vect{N}}{x}$ y $\pardiff{\vect{N}}{y}$ can be evaluated component-wise (again, see Felippa&#8217;s&nbsp;work):</p>
<p>$$\begin{aligned}
\matorvec{c}
{
    \pardiff{N_i}{x} \
    \pardiff{N_i}{y} 
} = 
\dfrac{1}{2A}
\matorvec{ccc}
{
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} \
    x_{32} <span class="amp">&amp;</span> x_{13} <span class="amp">&amp;</span> x_{21} 
}
\matorvec{c}
{
    \pardiff{N_i}{\zeta_1} \
    \pardiff{N_i}{\zeta_2} \
    \pardiff{N_i}{\zeta_3}&nbsp;}\end{aligned}$$</p>
<p>For example, for&nbsp;$N_1$:</p>
<p>$$\begin{aligned}
\matorvec{c}
{
    \pardiff{N_1}{x} \
    \pardiff{N_1}{y} 
} = 
\matorvec{c}
{
    \pardiff{\zeta_1}{x} \
    \pardiff{\zeta_1}{y} 
} = 
\dfrac{1}{2A}
\matorvec{ccc}
{
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} \
    x_{32} <span class="amp">&amp;</span> x_{13} <span class="amp">&amp;</span> x_{21} 
}
\matorvec{c}
{
    \pardiff{\zeta_1}{\zeta_1} \
    \pardiff{\zeta_1}{\zeta_2} \
    \pardiff{\zeta_1}{\zeta_3}
}
=
\dfrac{1}{2A}
\matorvec{ccc}
{
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} \
    x_{32} <span class="amp">&amp;</span> x_{13} <span class="amp">&amp;</span> x_{21} 
}
\matorvec{c}
{
    1 \
    0 \
    0
}
= 
\dfrac{1}{2A}
\matorvec{c}
{
    y_{23} \
    x_{32}&nbsp;}\end{aligned}$$</p>
<p>It is clear that,&nbsp;therefore</p>
<p>$$\begin{aligned}
\pardiff{\vect{N}}{x} = \dfrac{1}{2A}
\matorvec{ccc}
{
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} 
} \ 
\pardiff{\vect{N}}{y} = \dfrac{1}{2A}
\matorvec{ccc}
{
    x_{32} <span class="amp">&amp;</span> x_{13} <span class="amp">&amp;</span> x_{21}&nbsp;}\end{aligned}$$</p>
<p>Note that these derivatives are constant within each trinagle (hence the name, constant strain triangle although the interpretation is not strain in this case). In this context we have that $x_{ij} = x_i - x_j$ where  $x_i$ is the $x$ coordinate of the $i$-th element node. Similarly for $y_{ij} = y_i -&nbsp;y_j$.</p>
<p>If we further assume that the gravity field $g$, the local depth at the finite element and the Coriolis force $f$ are constant (probably a bad assumption for this variable for some applications which span the globe) <em>within an element</em> we can further reduce the discretized equations&nbsp;to:</p>
<p>$$\begin{aligned}
\vect{I}<em _Omega_e="\Omega^e">{1} &amp;= \int</em> \vect{N}^T \vect{N} \ud \Omega^e  \
\vect{I}<em _Omega_e="\Omega^e">{2} &amp;= \int</em> \vect{N}^T \pardiff{\vect{N}}{x} \ud \Omega^e \
\vect{I}<em _Omega_e="\Omega^e">{3} &amp;= \int</em> \vect{N}^T \pardiff{\vect{N}}{y} \ud&nbsp;\Omega^e\end{aligned}$$</p>
<p>Working on the first&nbsp;integral</p>
<p>$$\begin{aligned}
       \vect{I}<em _Omega_e="\Omega^e">1 &amp;= \int</em> \matorvec{c}{ \zeta_1 \ \zeta_2 \ \zeta_3 } \matorvec{ccc}{ \zeta_1 <span class="amp">&amp;</span> \zeta_2 <span class="amp">&amp;</span> \zeta_3 } \ud \Omega^e\
       &amp;=
       \int_{\Omega^e}<br>
        \matorvec{ccc}
        { 
            {\zeta_1}^2 <span class="amp">&amp;</span> \zeta_2\zeta_1 <span class="amp">&amp;</span> \zeta_3 \zeta_1 \
            \zeta_1\zeta_2 <span class="amp">&amp;</span> {\zeta_2}^2 <span class="amp">&amp;</span> \zeta_3\zeta_2  \
            \zeta_1\zeta_3 <span class="amp">&amp;</span> \zeta_2\zeta_3 <span class="amp">&amp;</span> {\zeta_3}^2  \
        } 
        \ud \Omega^e&nbsp;\end{aligned}$$</p>
<p>We can use the following formula for the integration within a triangle of the monomials (again, from <a href="feli">here</a>)</p>
<p>$$\begin{aligned}
\int_{\Omega^e} {\zeta_1}^p{\zeta_2}^q{\zeta_2}^r \ud \Omega^e = \dfrac{2 A p!\, q!\,&nbsp;r!}{\pare{p+q+r+2}!}\end{aligned}$$</p>
<p>With this, the integral for $\vect{I}_1$ is evaluated&nbsp;to</p>
<p>$$\begin{aligned}
\vect{I}_1 = \dfrac{A}{12} \matorvec{ccc}
        { 
            2 <span class="amp">&amp;</span> 1 <span class="amp">&amp;</span> 1 \
            1 <span class="amp">&amp;</span> 2 <span class="amp">&amp;</span> 1 \
            1 <span class="amp">&amp;</span> 1 <span class="amp">&amp;</span> 2
        }&nbsp;\end{aligned}$$</p>
<p>Proceeding with the next&nbsp;integral:</p>
<p>$$\begin{aligned}
\vect{I}<em _Omega_e="\Omega^e">{2} &amp;= \int</em> \vect{N}^T \pardiff{\vect{N}}{x} \ud \Omega^e \ 
 &amp;= \int_{\Omega^e} \matorvec{c}{ \zeta_1 \ \zeta_2 \ \zeta_3 } 
\dfrac{1}{2A}
\matorvec{ccc}
{
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} 
}  \ud \Omega^e = 
\int_{\Omega^e} \matorvec{c}{ \zeta_1 \ \zeta_2 \ \zeta_3 }  \ud \Omega^e
\cdot 
\dfrac{1}{2A}
\matorvec{ccc}
{
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} 
}\&nbsp;\end{aligned}$$</p>
<p>Utilizing the same identity as before to evaluate the integrals we arrive&nbsp;at:</p>
<p>$$\begin{aligned}
\vect{I}<em 23>2 = \dfrac{A}{3} \matorvec{c}{ 1 \ 1 \ 1 }\dfrac{1}{2A}
\matorvec{ccc}
{
    y</em> <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} 
} = 
\dfrac{1}{6}
\matorvec{ccc}
{
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12}  \
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12} \
    y_{23} <span class="amp">&amp;</span> y_{31} <span class="amp">&amp;</span> y_{12}&nbsp;}\end{aligned}$$</p>
<p>Analogously for $\vect{I}_3$ we&nbsp;have:</p>
<p>$$\begin{aligned}
\vect{I}<em _Omega_e="\Omega^e">{3} &amp;= \int</em> \vect{N}^T \pardiff{\vect{N}}{y} \ud \Omega^e = \dfrac{1}{6}
\matorvec{ccc}
{
    x_{32} <span class="amp">&amp;</span> x_{13} <span class="amp">&amp;</span> x_{21} \
    x_{32} <span class="amp">&amp;</span> x_{13} <span class="amp">&amp;</span> x_{21} \
    x_{32} <span class="amp">&amp;</span> x_{13} <span class="amp">&amp;</span> x_{21}&nbsp;}\end{aligned}$$</p>
<p>And finally we can write the sub-matrices as&nbsp;follows. </p>
<p>$$\begin{aligned}
 \vect{M} &amp;= \vect{I}<em hu>1 \
 \vect{K}</em> &amp;=  H \cdot {\vect{I}<em hv>2}^T <span class="amp">&amp;</span> \vect{K}</em> &amp;=  H \cdot {\vect{I}<em uh>3}^T \
 \vect{K}</em> &amp;=  g \cdot \vect{I}<em vh>2 <span class="amp">&amp;</span> \vect{K}</em> &amp;=  g \cdot \vect{I}<em uv>3 \
 \vect{K}</em> &amp;=  f \cdot \vect{I}<em vu>1 <span class="amp">&amp;</span> \vect{K}</em> &amp;=  f \cdot \vect{I}_1&nbsp;\end{aligned}$$</p>
<p>Which can be replaced into 
$$\begin{aligned}
\matorvec{ccc}
{
    \vect{M} <span class="amp">&amp;</span> \vect{0} <span class="amp">&amp;</span> \vect{0} \
    \vect{0} <span class="amp">&amp;</span> \vect{M} <span class="amp">&amp;</span> \vect{0} \
    \vect{0} <span class="amp">&amp;</span> \vect{0} <span class="amp">&amp;</span> \vect{M} 
} \dot{\vect{z}}  + 
\matorvec{ccc}
{
    \vect{0}        <span class="amp">&amp;</span> -\vect{K}<em hv>{hu} <span class="amp">&amp;</span> -\vect{K}</em> \
    \vect{K}<em uv>{uh}   <span class="amp">&amp;</span> \vect{0} <span class="amp">&amp;</span> -\vect{K}</em> \
    \vect{K}<em vu>{vh}   <span class="amp">&amp;</span> \vect{K}</em> <span class="amp">&amp;</span> \vect{0} 
} \vect{z}
=
\matorvec{c}
{
    \vect{0} \ \vect{0} \ \vect{0}
} \ 
\vect{A} \dot{\vect{z}} + \vect{B}  \vect{z} = \vect{0}\end{aligned}$$
to generate the discretized <span class="caps">SWE</span>. </p>
<p>A future post will discuss the python implementation of this finite element and its application to a basic&nbsp;problem. </p>
        </div>

        <div class="meta">
            <div>
                    <a href="http://www.joseabell.com/tag/finite-elements.html" class="tag">Finite Elements</a>
                    <a href="http://www.joseabell.com/tag/fluids.html" class="tag">Fluids</a>
                    <a href="http://www.joseabell.com/tag/shallow-water-equations.html" class="tag">Shallow water equations</a>
                    <a href="http://www.joseabell.com/tag/tutorial.html" class="tag">Tutorial</a>
            </div>
            <!-- <div>
                <a id="comments-button" class="comments_btn" href="#disqus_thread">Comments</a>
            </div> -->
        </div>
    </article>
</div>


<script type="text/javascript">
(function () {
    'use strict';

    // Global object
    var App = {};

    // Create button
    // App.commentsButton = document.getElementById('comments-button');

    // App.commentsButton.onclick = function () {
    //     // Remove button action on click
        // App.commentsButton.onclick = function () {
        // }

        // Create comments container
        App.disqusContainer = document.createElement('div');
        App.disqusContainer.setAttribute('id', 'disqus_thread');
        // App.disqusContainer.setAttribute('class', 'container');

        // Append container to body or div
        // document.body.appendChild( App.disqusContainer );
        var container = document.getElementsByClassName('container post')[0];
        container.appendChild(App.disqusContainer);

        // Your Disqus shortname
        App.disqus_shortname = 'joseabell';

        // Embed Disqus
        var dsq = document.createElement('script');

        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + App.disqus_shortname + '.disqus.com/embed.js';

        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

    //     window.scrollTo(0, dsq.offsetTop - 200);
    // };
})();
</script>


<!-- 
<script type="text/javascript">
    var disqus_shortname = 'joseabell';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
    }());
</script>
 -->



        <!-- Github buttons. -->
        <script async defer src="https://buttons.github.io/buttons.js"></script>
    </body>
</html>