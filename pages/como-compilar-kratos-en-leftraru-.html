
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Como compilar kratos en leftraru</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="" />
        <meta name="author" content="Jose Abell" />

    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/flexslider.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/style.css">
    <!-- Custom style  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/custom.css">
    <!-- pygments code highlight -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/pygments.css">
    <!-- tipue search -->
    <link rel="stylesheet" href="https://joseabell.com/theme/tipuesearch/css/tipuesearch.css">
    <!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" > -->
    <script src="https://kit.fontawesome.com/2dfe6f2f70.js" crossorigin="anonymous"></script>


    <!-- Modernizr JS -->
    <script src="https://joseabell.com/theme/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="/theme/js/respond.min.js"></script>
    <![endif]-->
        <link href="https://joseabell.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jose Abells Reasearch Blog Atom">




    </head>
    <body>
    <!-- Uncomment for fun -->
    <!-- <marquee bgcolor="red" height="50px" style="color:yellow;font-size:30px;"> OMG COVID--19 ALERT TAKE COVER ALL!!! </marquee> -->
    <div id="fh5co-page">
        <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
        <aside id="fh5co-aside" role="complementary" class="border js-fullheight">


            <nav class="fh5co-main-menu" role="navigation">
            </nav>


            
            <div class="clearfix"></div>
            <h1  id="fh5co-logo">
                <a href="https://joseabell.com/index.html">
                    <img src="/images/sitelogo.svg" />
                </a>
            </h1>


            <nav class="fh5co-main-menu" role="navigation">

<ul>
    <!-- home link -->
    <li><a href="https://joseabell.com/">Home</a></li>

    <!-- page links -->
            <li><a href="https://joseabell.com/pages/01about.html">About</a></li>
            <li><a href="https://joseabell.com/pages/04publications.html">Publications</a></li>
            <li><a href="https://joseabell.com/pages/05tools.html">Tools</a></li>

    <!-- categories -->
        <li><a href="https://joseabell.com/categories.html">Categories</a></li>

    <!-- tags -->
        <li><a href="https://joseabell.com/tags.html">Tags</a></li>

    <!-- additional menu items from config -->

</ul><!--                 <ul><li><form id="searchform" action="https://joseabell.com/search.html">
    <input id="tipue_search_input" data-siteurl="https://joseabell.com" type="text" size="60" class="form-control search-field" name="q">

    <button type="submit" class="btn btn-primary search-submit"><i class="icon-search4"></i></button>
</form></li></ul> -->



<ul id="social"><li>
            <li><a href="https://www.github.com/jaabell" alt="Github"><i class="fab fa-github fa-2x"></i></a></li>
            <li><a href="https://www.youtube.com/c/JoseAAbellM" alt="Youtube"><i class="fab fa-youtube fa-2x"></i></a></li>

            <li><a href="https://www.researchgate.net/profile/Jose_Abell/" alt="researchgate"><i class="fab fa-researchgate fa-2x"></i></a></li>

            <li><a href="linkedin.com/in/josÃ©-abell-93194129" alt="linkedin"><i class="fab fa-linkedin fa-2x"></i></a></li>


</li>
</ul>            
            <ul id="map">
                <li>
                Visitors come from
                <script type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?cl=b3b3b3&w=250&t=n&d=XCjx4HKZp-atwA8u2pe4wbQt9_6FCkYMlpMpnxG6qMU&co=f5f5f5&cmo=027aae&cmn=a03338&ct=808080"></script>
                </li>
            </ul>
            </nav>

        </aside>

        <div id="fh5co-main">

    <div class="fh5co-narrow-content page-content">
        <h1 class="fh5co-heading-colored"><i class=""></i> Como compilar kratos en leftraru</h1>
        <div class="animate-box" data-animate-effect="fadeInLeft">
            <!-- <p class="fh5co-lead animate-box" data-animate-effect="fadeInLeft"></p> -->
            <p class="animate-box " data-animate-effect="fadeInLeft"><h1>Como compilar kratos en leftraru</h1>
<p>Resumen: <em>hay que compilar todo a mano</em></p>
<h2>Cargar modulos necesarios:</h2>
<div class="highlight"><pre><span></span><code><span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">intel</span><span class="o">/</span><span class="mi">2018</span><span class="n">c</span><span class="w">       </span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">impi</span><span class="o">/</span><span class="mf">2018.2</span><span class="o">.</span><span class="mi">199</span><span class="w">   </span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">metis</span><span class="o">/</span><span class="mf">5.1</span><span class="o">.</span><span class="mi">0</span><span class="w"></span>
</code></pre></div>

<h2>Descargar dependencias:</h2>
<p>Necesitamos descargar y compilar a mano las siguientes librerias</p>
<ul>
<li>zlib</li>
<li>Python3</li>
<li>Trilinos</li>
<li>Boost</li>
<li>Kratos</li>
</ul>
<p>Bajarlas usando:</p>
<div class="highlight"><pre><span></span><code><span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">zlib</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">zlib</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mf">11.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="w"></span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">ftp</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="mf">3.5</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="mf">3.5</span><span class="o">.</span><span class="mf">5.</span><span class="n">tgz</span><span class="w"></span>
<span class="n">wget</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">trilinos</span><span class="o">.</span><span class="n">csbsju</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">trilinos</span><span class="o">-</span><span class="mf">12.12</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">Source</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="w"></span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sourceforge</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">boost</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">boost</span><span class="o">/</span><span class="mf">1.59</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">boost_1_59_0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">KratosMultiphysics</span><span class="o">/</span><span class="n">Kratos</span><span class="o">.</span><span class="n">git</span><span class="w"></span>
</code></pre></div>

<p>Descomprimir dependencias:</p>
<div class="highlight"><pre><span></span><code>tar -xzvf zlib-1.2.11.tar.gz
tar -xzvf Python-3.5.5.tgz
tar -xzvf trilinos-12.12.1-Source.tar.gz
tar -xzvf boost_1_59_0.tar.gz
</code></pre></div>

<h2>Compilar zlib</h2>
<div class="highlight"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="n">zlib</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">11</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">CC</span><span class="o">=</span><span class="n">icc</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-O3 -xHost -ip&#39;</span><span class="w"></span>
<span class="o">./</span><span class="n">configure</span><span class="w"> </span><span class="o">--</span><span class="n">prefix</span><span class="o">=$</span><span class="n">HOME</span><span class="w"></span>
<span class="n">make</span><span class="w"> </span><span class="o">-</span><span class="n">j</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="n">make</span><span class="w"> </span><span class="n">install</span><span class="w"></span>
</code></pre></div>

<p>Una vez listo, deberiamos tener las librerias compiladas en <code>$HOME</code>.</p>
<div class="highlight"><pre><span></span><code>ls $HOME/lib/libz*
</code></pre></div>

<p>Entrega algo como:</p>
<div class="highlight"><pre><span></span><code>/home/jabell/lib/libz.a  /home/jabell/lib/libz.so  /home/jabell/lib/libz.so.1  /home/jabell/lib/libz.so.1.2.11
</code></pre></div>

<p>Volver al home </p>
<div class="highlight"><pre><span></span><code>cd ~
</code></pre></div>

<h2>Compilar python3</h2>
<p>Compilar e instalar</p>
<div class="highlight"><pre><span></span><code>cd Python-3.5.5
./configure --with-icc --without-gcc --prefix=$HOME --enable-shared
make -j 20
make install
</code></pre></div>

<p>Hacer un link simbolico para que no se maree trilinos</p>
<div class="highlight"><pre><span></span><code><span class="nv">cd</span> <span class="o">~/</span><span class="k">include</span>
<span class="nv">ln</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">python3</span>.<span class="mi">5</span><span class="nv">m</span><span class="o">/</span> <span class="nv">python3</span>.<span class="mi">5</span>
<span class="nv">cd</span> ..
</code></pre></div>

<h2>Compilar boost</h2>
<p>Esto es cacho. Tener paciencia, como dice el compilador a cada rato...</p>
<div class="highlight"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="n">boost_1_59_0</span><span class="w"></span>
<span class="o">./</span><span class="n">bootstrap</span><span class="o">.</span><span class="n">sh</span><span class="w">  </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">python</span><span class="o">-</span><span class="n">version</span><span class="o">=</span><span class="mf">3.5</span><span class="w"> </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">libraries</span><span class="o">=</span><span class="n">python</span><span class="p">,</span><span class="n">mpi</span><span class="p">,</span><span class="n">serialization</span><span class="w"> </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">toolset</span><span class="o">=</span><span class="n">intel</span><span class="o">-</span><span class="n">linux</span><span class="w"> </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">python</span><span class="o">=$</span><span class="n">HOME</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">5</span><span class="n">m</span><span class="w"> </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">python</span><span class="o">-</span><span class="n">root</span><span class="o">=$</span><span class="n">HOME</span><span class="o">/</span><span class="w"></span>
</code></pre></div>

<p>Editar <code>project-config.jam</code> usando nano</p>
<div class="highlight"><pre><span></span><code>nano project-config.jam
</code></pre></div>

<p>Al final del archivo agregar la linea:</p>
<div class="highlight"><pre><span></span><code>using mpi : /home/apps/intel/2018/compilers_and_libraries_2018.2.199/linux/mpi_2019/intel64/bin/mpicc ;
</code></pre></div>

<p>Luego llamar el compilado:</p>
<div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">b2</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">python</span><span class="w"> </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">serialization</span><span class="w"> </span><span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">mpi</span><span class="w"> </span><span class="n">variant</span><span class="o">=</span><span class="n">release</span><span class="w"> </span><span class="n">cxxflags</span><span class="o">=</span><span class="s2">&quot;-std=c++11&quot;</span><span class="w"> </span><span class="n">link</span><span class="o">=</span><span class="n">shared</span><span class="w"> </span><span class="n">address</span><span class="o">-</span><span class="n">model</span><span class="o">=</span><span class="mi">64</span><span class="w"> </span><span class="n">toolset</span><span class="o">=</span><span class="n">intel</span><span class="w"> </span>
<span class="o">./</span><span class="n">b2</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">--</span><span class="n">prefix</span><span class="o">=$</span><span class="n">HOME</span><span class="w"></span>
<span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="w"></span>
</code></pre></div>

<h2>Compilar Trilinos</h2>
<p>En este se usa CMAKE</p>
<div class="highlight"><pre><span></span><code>cd trilinos-12.12.1-Source
mkdir build
</code></pre></div>

<p>Crear <code>do_configure.sh</code> estos eran los contenidos del mio:</p>
<div class="highlight"><pre><span></span><code><span class="n">TRILINOS_ROOT</span><span class="o">=</span><span class="s2">&quot;${HOME}/trilinos-12.12.1-Source&quot;</span><span class="w"></span>
<span class="n">EXTRA_LINK_FLAGS</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w"></span>
<span class="n">EXTRA_ARGS</span><span class="o">=$</span><span class="err">@</span><span class="w"></span>
<span class="n">MPI_ROOT</span><span class="o">=</span><span class="s2">&quot;${MPI_ROOT}&quot;</span><span class="w"></span>
<span class="n">METIS_ROOT</span><span class="o">=</span><span class="s2">&quot;/home/apps/parmetis/4.0.3/&quot;</span><span class="w"></span>
<span class="n">LAPACK_ROOT</span><span class="o">=</span><span class="s2">&quot;${MKLROOT}/lib/intel64&quot;</span><span class="w"></span>

<span class="n">echo</span><span class="w"> </span><span class="s2">&quot;TRILINOS_ROOT = $TRILINOS_ROOT&quot;</span><span class="w"></span>
<span class="n">echo</span><span class="w"> </span><span class="s2">&quot;EXTRA_LINK_FLAGS = $EXTRA_LINK_FLAGS&quot;</span><span class="w"></span>
<span class="n">echo</span><span class="w"> </span><span class="s2">&quot;EXTRA_ARGS = $EXTRA_ARGS&quot;</span><span class="w"></span>
<span class="n">echo</span><span class="w"> </span><span class="s2">&quot;MPI_ROOT = $MPI_ROOT&quot;</span><span class="w"></span>
<span class="n">echo</span><span class="w"> </span><span class="s2">&quot;METIS_ROOT = $METIS_ROOT&quot;</span><span class="w"></span>
<span class="n">echo</span><span class="w"> </span><span class="s2">&quot;LAPACK_ROOT = $LAPACK_ROOT&quot;</span><span class="w"></span>

<span class="n">rm</span><span class="w"> </span><span class="n">CMakeCache</span><span class="o">.</span><span class="n">txt</span><span class="w"></span>
<span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">rf</span><span class="w"> </span><span class="n">CMakeFiles</span><span class="w"></span>
<span class="n">rm</span><span class="w"> </span><span class="o">*.</span><span class="n">cmake</span><span class="w"></span>


<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">intel</span><span class="o">/</span><span class="mi">2018</span><span class="n">c</span><span class="w">       </span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">boost</span><span class="o">/</span><span class="mf">1.59</span><span class="w">        </span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">python</span><span class="o">/</span><span class="mf">3.5</span><span class="o">.</span><span class="mi">2</span><span class="w">      </span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">parmetis</span><span class="o">/</span><span class="mf">4.0</span><span class="o">.</span><span class="mi">3</span><span class="w"></span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">impi</span><span class="o">/</span><span class="mf">2018.2</span><span class="o">.</span><span class="mi">199</span><span class="w">   </span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">llvm</span><span class="o">/</span><span class="mf">3.8</span><span class="o">.</span><span class="mi">1</span><span class="w">        </span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">metis</span><span class="o">/</span><span class="mf">5.1</span><span class="o">.</span><span class="mi">0</span><span class="w"></span>


<span class="n">cmake</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="s2">&quot;${TRILINOS_ROOT}&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="n">RELEASE</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_SOURCE_DIR</span><span class="o">=</span><span class="s2">&quot;${TRILINOS_SOURCE}&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">icpc</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">icc</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_Fortran_COMPILER</span><span class="o">=</span><span class="n">ifort</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTPL_ENABLE_MPI</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_CXX11</span><span class="o">=</span><span class="n">ON</span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMPI_BASE_DIR</span><span class="o">=</span><span class="s2">&quot;${MPI_ROOT}&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMPI_INCLUDE_DIRS</span><span class="p">:</span><span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;${MPI_ROOT}/include&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DBUILD_SHARED_LIBS</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DBLAS_LIBRARY_DIRS</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="s2">&quot;${MKLROOT}/lib/intel64&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DBLAS_LIBRARY_NAMES</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;mkl_rt&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DLAPACK_LIBRARY_DIRS</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="s2">&quot;${MKLROOT}/lib/intel64&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DLAPACK_LIBRARY_NAMES</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;mkl_rt&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTPL_ENABLE_MKL</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMKL_LIBRARY_DIRS</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="s2">&quot;${MKLROOT}/lib/intel64&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMKL_LIBRARY_NAMES</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;mkl_rt&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMKL_INCLUDE_DIRS</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="s2">&quot;${MKLROOT}/include&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTPL_ENABLE_ParMETIS</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DParMETIS_INCLUDE_DIRS</span><span class="p">:</span><span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;${METIS_ROOT}/include&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DParMETIS_LIBRARY_NAMES</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;parmetis&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DParMETIS_LIBRARY_DIRS</span><span class="p">:</span><span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;${METIS_ROOT}/lib&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTPL_ENABLE_METIS</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMETIS_INCLUDE_DIRS</span><span class="p">:</span><span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;${METIS_ROOT}/include&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMETIS_LIBRARY_NAMES</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;metis&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DMETIS_LIBRARY_DIRS</span><span class="p">:</span><span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;${METIS_ROOT}/lib&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_EXTRA_LINK_FLAGS</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;$EXTRA_LINK_FLAGS&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Amesos</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DAmesos_ENABLE_SuperLUDist</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">OFF</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Anasazi</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_AztecOO</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DAztecOO_ENABLE_Teuchos</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Didasko</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Epetra</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_EpetraExt</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Galeri</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Ifpack</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_ML</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_PyTrilinos</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">OFF</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Teuchos</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DTrilinos_ENABLE_Triutils</span><span class="p">:</span><span class="n">BOOL</span><span class="o">=</span><span class="n">ON</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DDART_TESTING_TIMEOUT</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="mi">600</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_Fortran_FLAGS</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;-O5 -funroll-all-loops -fPIC&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_C_FLAGS</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;-O3 -fPIC -funroll-loops -march=native&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="n">DCMAKE_CXX_FLAGS</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="s2">&quot;-O3 -fPIC -funroll-loops -ffast-math -march=native -DMPICH_IGNORE_CXX_SEEK&quot;</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">$</span><span class="n">EXTRA_ARGS</span><span class="w"> </span>\<span class="w"></span>
<span class="w">  </span><span class="o">$</span><span class="p">{</span><span class="n">TRILINOS_SOURCE</span><span class="p">}</span><span class="w"> </span><span class="o">..</span><span class="w"></span>
</code></pre></div>

<p>Preparar compilado</p>
<div class="highlight"><pre><span></span><code>sh do_configure.sh
make -j 20
</code></pre></div>

<p>TENER MUCHA PACIENCIA</p>
<div class="highlight"><pre><span></span><code>cd ..
</code></pre></div>

<h2>Compilar Kratos</h2>
<div class="highlight"><pre><span></span><code>cd Kratos
</code></pre></div>

<p>Descargar <code>tetgen</code></p>
<div class="highlight"><pre><span></span><code>cd applications/PfemApplication/external_modules/
git clone https://github.com/ufz/tetgen.git
cd ../../../
</code></pre></div>

<p>Preparar configuracion</p>
<div class="highlight"><pre><span></span><code>mkdir build
cd build
nano conf.sh
</code></pre></div>

<p>Este es mi archivo <code>conf.sh</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># this is an example file...please DO NOT MODIFY if you don&#39;t want to do it for everyone</span>
<span class="c1">#to use it, copy it to another file and run it</span>

<span class="c1"># additional compiler flags could be added customizing the corresponding var, for example</span>
<span class="c1"># -DCMAKE_CXX_FLAGS=&quot;${CMAKE_CXX_FLAGS} -msse3 &quot;. Note that the &quot;defaults are already correctly coded&quot;</span>
<span class="c1">#so we should ass here only machine specific stuff</span>

<span class="c1">#an effort is made to autodetect all of the libraries needed HOWEVER:</span>
<span class="c1">#METIS_APPLICATION needs the var PARMETIS_ROOT_DIR to be specified by the user (not needed if the app is set to OFF)</span>
<span class="c1">#TRILINOS_APPLICATION needs the var PARMETIS_ROOT_DIR to be specified by the user (not needed if the app is set to OFF)</span>
<span class="c1">#MKL_SOLVERS_APPLICATION needs the var MKLSOLVER_INCLUDE_DIR and MKLSOLVER_LIB_DIR to be specified by the user (not needed if the app is set to OFF)</span>
<span class="c1">#note that the MKLSOLVER_LIB_DIR should include /lib/em64t. This is needed as intel is changing location of mkl at every update of the compiler!!</span>

<span class="c1">#the user should also note that the symbol &quot;\&quot; marks that the command continues on the next line. IT SHOULD ONLY BE FOLLOWED</span>
<span class="c1">#BY the &quot;ENTER&quot; and NOT by any space!!</span>

clear

module load intel/2018c            
module load impi/2018.2.199   
module load metis/5.1.0

<span class="c1">#you may want to decomment this the first time you compile</span>
rm CMakeCache.txt
rm *.cmake
rm -rf CMakeFiles<span class="se">\</span>

cmake ..                                                              <span class="se">\</span>
    -DCMAKE_C_COMPILER<span class="o">=</span>icc                                                <span class="se">\</span>
    -DCMAKE_INSTALL_RPATH_USE_LINK_PATH<span class="o">=</span>TRUE                              <span class="se">\</span>
    -DCMAKE_INSTALL_RPATH<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/Kratos/libs&quot;</span>                      <span class="se">\</span>
    -DCMAKE_CXX_COMPILER<span class="o">=</span>icpc                                             <span class="se">\</span>
    -DCMAKE_CXX_FLAGS<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -msse3 -std=c++11 &quot;</span>             <span class="se">\</span>
    -DCMAKE_C_FLAGS<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMAKE_C_FLAGS</span><span class="si">}</span><span class="s2"> -msse3 &quot;</span>                            <span class="se">\</span>
    -DBOOST_ROOT<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/&quot;</span>                             <span class="se">\</span>
    -DPYTHON_LIBRARY<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/lib/libpython3.5m.so&quot;</span>        <span class="se">\</span>
    -DPYTHON_INCLUDE_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/include/python3.5m&quot;</span>                <span class="se">\</span>
    -DCMAKE_BUILD_TYPE<span class="o">=</span>Release                                            <span class="se">\</span>
    -DCONSTITUTIVE_MODELS_APPLICATION<span class="o">=</span>ON                                  <span class="se">\</span>
    -DFLUID_DYNAMICS_APPLICATION<span class="o">=</span>ON                                       <span class="se">\</span>
    -DCONVECTION_DIFFUSION_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DDEM_APPLICATION<span class="o">=</span>ON                                                  <span class="se">\</span>
    -DSWIMMING_DEM_APPLICATION<span class="o">=</span>OFF                                        <span class="se">\</span>
    -DINCOMPRESSIBLE_FLUID_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DMESHING_APPLICATION<span class="o">=</span>ON                                              <span class="se">\</span>
    -DEXTERNAL_SOLVERS_APPLICATION<span class="o">=</span>ON                                     <span class="se">\</span>
    -DSTRUCTURAL_APPLICATION<span class="o">=</span>ON                                           <span class="se">\</span>
    -DSTRUCTURAL_MECHANICS_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DALE_APPLICATION<span class="o">=</span>ON                                                  <span class="se">\</span>
    -DFSI_APPLICATION<span class="o">=</span>ON                                                  <span class="se">\</span>
    -DMAPPING_APPLICATION<span class="o">=</span>OFF                                             <span class="se">\</span>
    -DOPENCL_APPLICATION<span class="o">=</span>OFF                                              <span class="se">\</span>
    -DMIXED_ELEMENT_APPLICATION<span class="o">=</span>ON                                        <span class="se">\</span>
    -DINSTALL_EMBEDDED_PYTHON<span class="o">=</span>ON                                          <span class="se">\</span>
    -DSHAPE_OPTIMIZATION_APPLICATION<span class="o">=</span>ON                                   <span class="se">\</span>
    -DTOPOLOGY_OPTIMIZATION_APPLICATION<span class="o">=</span>OFF                               <span class="se">\</span>
    -DPFEM_APPLICATION<span class="o">=</span>ON                                                 <span class="se">\</span>
    -DPFEM_FLUID_DYNAMICS_APPLICATION<span class="o">=</span>ON                                  <span class="se">\</span>
    -DCONTACT_MECHANICS_APPLICATION<span class="o">=</span>ON                                    <span class="se">\</span>
    -DSOLID_MECHANICS_APPLICATION<span class="o">=</span>ON                                      <span class="se">\</span>
    -DPFEM_SOLID_MECHANICS_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DPARTICLE_MECHANICS_APPLICATION<span class="o">=</span>ON                                   <span class="se">\</span>
    -DUMAT_APPLICATION<span class="o">=</span>ON                                                 <span class="se">\</span>
    -DMETIS_APPLICATION<span class="o">=</span>ON                                                <span class="se">\</span>
    -DMETIS_INCLUDE_DIR<span class="o">=</span><span class="s2">&quot;/home/apps/metis/5.1.0/include&quot;</span>               <span class="se">\</span>
    -DMETIS_ROOT_DIR<span class="o">=</span><span class="s2">&quot;/home/apps/metis/5.1.0/&quot;</span>               <span class="se">\</span>
    -DUSE_METIS_5<span class="o">=</span>ON                                                      <span class="se">\</span>
    -DTRILINOS_APPLICATION<span class="o">=</span>ON                                             <span class="se">\</span>
    -DTRILINOS_LIBRARY_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/trilinos-12.12.1-Source/lib&quot;</span>     <span class="se">\</span>
    -DTRILINOS_INCLUDE_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/trilinos-12.12.1-Source/include&quot;</span> <span class="se">\</span>
    -DCONVECTION_DIFFUSION_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DEXTERNAL_SOLVERS_APPLICATION<span class="o">=</span>ON                                     <span class="se">\</span>
    -DSOLID_MECHANICS_APPLICATION<span class="o">=</span>ON                                      <span class="se">\</span>
    -DZLIB_LIBRARY<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/lib/libz.so&quot;</span>                                      <span class="se">\</span>
    -DPOROMECHANICS_APPLICATION<span class="o">=</span>ON
</code></pre></div>
</td></tr></table>
<p>Luego configurar, compilar e instalar</p>
<div class="highlight"><pre><span></span><code>sh conf.sh
make -j 20
make install
</code></pre></div>

<p>Irse a caminar un rato o practicar los trucos de magia...</p>
<p>Al instalar, si sale un error parecido a:</p>
<div class="highlight"><pre><span></span><code>CMake Error at cmake_install.cmake:69 (FILE):
   file INSTALL cannot find &quot;/home/jabell/Kratos/-lm&quot;.
</code></pre></div>

<p>Editar <code>cmake_install.sh</code></p>
<div class="highlight"><pre><span></span><code>nano cmake_install.sh
</code></pre></div>

<p>Y quitar (CTRL+K) la linea que dice:</p>
<div class="highlight"><pre><span></span><code>&quot;/home/jabell/Kratos/-lm&quot;
</code></pre></div>

<p>(Pro tip: busqueda con nano es "CTRL+/" colocar <code>-lm</code>).</p>
<h2>Modificar .bashrc</h2>
<p>Editar <code>.bashrc</code></p>
<div class="highlight"><pre><span></span><code>cd ~
nano .bashrc
</code></pre></div>

<p>Agregar las siguientes lineas al final del <code>.bashrc</code></p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">PATH</span><span class="o">=$</span><span class="n">PATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">Kratos</span><span class="o">/</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">PYTHONPATH</span><span class="o">=$</span><span class="n">PYTHONPATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">Kratos</span><span class="o">/</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">LD_LIBRARY_PATH</span><span class="o">=$</span><span class="n">LD_LIBRARY_PATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">Kratos</span><span class="o">/</span><span class="n">libs</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">LD_LIBRARY_PATH</span><span class="o">=$</span><span class="n">LD_LIBRARY_PATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">lib</span><span class="w"></span>


<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">parmetis</span><span class="o">/</span><span class="mf">4.0</span><span class="o">.</span><span class="mi">3</span><span class="w"></span>
<span class="n">module</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">metis</span><span class="o">/</span><span class="mf">5.1</span><span class="o">.</span><span class="mi">0</span><span class="w"></span>
</code></pre></div>

<p>Guardar y salirse. Incorporar los cambios al <code>.bashrc</code></p>
<div class="highlight"><pre><span></span><code>source .bashrc
</code></pre></div>

<h2>PROBAR LA BESTIA!!!</h2>
<p>Crear un archivo <code>testkratos.py</code> en el home</p>
<div class="highlight"><pre><span></span><code>nano testkratos.py
</code></pre></div>

<p>Poner adentro:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">KratosMultiphysics</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">KratosMultiphysics.mpi</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">KratosMultiphysics.MetisApplication</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">KratosMultiphysics.TrilinosApplication</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div>

<p>Guardar y ejecutar</p>
<div class="highlight"><pre><span></span><code>runkratos testkratos.py
</code></pre></div>

<p>Deberia resultar en </p>
<div class="highlight"><pre><span></span><code> |  /           |             
 &#39; /   __| _` | __|  _ \   __|
 . \  |   (   | |   (   |\__ \ 
<span class="ge">_|\_</span>\_|  \__,_|\__|\___/ ____/
           Multi-Physics 6.0.0-4212599
Importing    KratosMetisApplication
Initializing Kratos MetisApplication... 
Importing    KratosTrilinosApplication
     KRATOS   _____     <span class="ge">_ _</span> _                 
             |_   _| __(_) (_)_ __   ___  ___ 
               | || &#39;__| | | | &#39;_ \ / _ \/ __|
               | || |  | | | | | | | (_) \__ \
               |_||_|  |_|_|_|_| |_|\___/|___/ APPLICATION     
KRATOS TERMINATED CORRECTLY
</code></pre></div>

<h2>Probar Kratos en el gestor de colas</h2>
<p>Crear un batch script para SLURM (el gestor de colas) llamado <code>testkratos.sh</code> que contenga</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash -l</span>
<span class="c1">#SBATCH -n 2  # pedir dos procesos</span>
<span class="c1">#SBATCH -J testkratos</span>
<span class="c1">#SBATCH --time=00:01:00  #Time requested</span>
<span class="c1">#SBATCH --error=testkratos.%A.err</span>
<span class="c1">#SBATCH --output=testkratos.%A.out</span>
<span class="c1">#SBATCH --mail-type=ALL # Type of email notification- BEGIN,END,FAIL,ALL</span>
<span class="c1">#SBATCH --mail-user=ja.abell@gmail.com # Email to which notifications will be sent</span>

srun runkratos testkratos.py
</code></pre></div>
</td></tr></table>
<p>Este archivo especifica los requerimientos de recursos a leftraru. Debiera ser bastante obvio lo que significa todo. Por siacaso aqui esta la expliacion</p>
<p>Pedir cantidad de procesos</p>
<div class="highlight"><pre><span></span><code>#SBATCH -n 2  # pedir dos procesos
</code></pre></div>

<p>Hay comandos para solicitar cierto numero de nodos o de proceso por nodo y otras configuraciones. Tambien se pueden correr <code>arreglos</code> o familias de tareas relacionadas usando la opcion <code>array</code>.</p>
<p>Nombre de la tarea </p>
<div class="highlight"><pre><span></span><code>#SBATCH -J testkratos
</code></pre></div>

<p>Tiempo solicitado.</p>
<div class="highlight"><pre><span></span><code>#SBATCH --time=00:01:00  #Time requested
</code></pre></div>

<p>La salida del programa, error y standar-out, se redirigen a los archivos especificados por las lineas:</p>
<div class="highlight"><pre><span></span><code>#SBATCH --error=testkratos.%A.err
#SBATCH --output=testkratos.%A.out
</code></pre></div>

<p>Donde <code>%A</code> se reemplaza por el numero de la tarea. </p>
<p>Para mandar un email con cada cambio de estado de la tarea usar:</p>
<div class="highlight"><pre><span></span><code><span class="n">#SBATCH</span><span class="w"> </span><span class="o">--</span><span class="n">mail</span><span class="o">-</span><span class="n">type</span><span class="o">=</span><span class="ow">ALL</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="n">notification</span><span class="o">-</span><span class="w"> </span><span class="k">BEGIN</span><span class="p">,</span><span class="k">END</span><span class="p">,</span><span class="n">FAIL</span><span class="p">,</span><span class="ow">ALL</span><span class="w"></span>
<span class="n">#SBATCH</span><span class="w"> </span><span class="c1">--mail-user=ja.abell@gmail.com # Email to which notifications will be sent</span>
</code></pre></div>

<p>Finalmente, este es el comando que queremos ejecutar:</p>
<div class="highlight"><pre><span></span><code>srun runkratos testkratos.py
</code></pre></div>

<p>Pueden haber mas comandos o pasos a seguir. Aqui <code>srun</code> reemplaza la llamada a <code>mpirun</code>.</p>
<p>Ejecutar el script (poner en la cola)</p>
<div class="highlight"><pre><span></span><code>sbatch testkratos.sh
</code></pre></div>

<p>Deberia decir algo como </p>
<div class="highlight"><pre><span></span><code>Submitted batch job 10894854
</code></pre></div>

<p>Se puede revisar el status de la tarea solicitada mediante</p>
<div class="highlight"><pre><span></span><code>squeue
</code></pre></div>

<p>Que dice algo como esto cuanto la tarea esta corriendo </p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">jabell@leftraru3 ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">squeue</span><span class="w"></span>
<span class="w">             </span><span class="n">JOBID</span><span class="w"> </span><span class="k">PARTITION</span><span class="w">     </span><span class="n">NAME</span><span class="w">     </span><span class="k">USER</span><span class="w"> </span><span class="n">ST</span><span class="w">       </span><span class="nc">TIME</span><span class="w">  </span><span class="n">NODES</span><span class="w"> </span><span class="n">NODELIST</span><span class="p">(</span><span class="n">REASON</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="mi">10894854</span><span class="w">     </span><span class="n">slims</span><span class="w"> </span><span class="n">testkrat</span><span class="w">   </span><span class="n">jabell</span><span class="w"> </span><span class="n">PD</span><span class="w">       </span><span class="mi">0</span><span class="err">:</span><span class="mi">00</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">Priority</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>La salida del programa la encontramos en los archivos .err y .out generados. En mi caso, </p>
<div class="highlight"><pre><span></span><code>more testkratos.10894854.4294967294.err
</code></pre></div>

<p>Resulta vacio, y </p>
<div class="highlight"><pre><span></span><code>more testkratos.10894854.4294967294.out
</code></pre></div>

<p>resulta en </p>
<div class="highlight"><pre><span></span><code> |  /           |             
 &#39; /   __| _` | __|  _ \   __|
 . \  |   (   | |   (   |\__ \ 
<span class="ge">_|\_</span>\_|  \__,_|\__|\___/ ____/
           Multi-Physics 6.0.0-4212599
 |  /           |             
 &#39; /   __| _` | __|  _ \   __|
 . \  |   (   | |   (   |\__ \ 
<span class="ge">_|\_</span>\_|  \__,_|\__|\___/ ____/
           Multi-Physics 6.0.0-4212599
Initializing Kratos MetisApplication... 
Initializing Kratos MetisApplication... 
     KRATOS   _____     <span class="ge">_ _</span> _                 
             |_   _| __(_) (_)_ __   ___  ___ 
               | || &#39;__| | | | &#39;_ \ / _ \/ __|
               | || |  | | | | | | | (_) \__ \
               |_||_|  |_|_|_|_| |_|\___/|___/ APPLICATION     
Importing    KratosMetisApplication
Importing    KratosTrilinosApplication
KRATOS TERMINATED CORRECTLY
Importing    KratosMetisApplication
Importing    KratosTrilinosApplication
KRATOS TERMINATED CORRECTLY
</code></pre></div>

<p>Notar que corrieron dos Kratos (pedimos dos procesos). Supongo que hay mas cambios que hay que hacer en los scripts python que queremos correr, pero eso es todo por ahora. </p>
<p><img alt="Arrivederci" src="https://i.gifer.com/4xw2.gif"></p></p>
        </div>
    </div>


    <!-- <div class="fh5co-footer">
    <p><small>&copy; 2016 Blend Free HTML5. All Rights Reserved.</span> <span>Designed by <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a></span>
    <br /><span>Pelican Theme by: <a href="https://github.com/claudio-walser/pelican-fh5co-marble" target="_blank">Claudio Walser</a></span></small></p>

</div>                 -->

        </div>
    </div>

    <!-- jQuery -->
    <script src="https://joseabell.com/theme/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="https://joseabell.com/theme/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="https://joseabell.com/theme/js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="https://joseabell.com/theme/js/jquery.waypoints.min.js"></script>
    <!-- Flexslider -->
    <script src="https://joseabell.com/theme/js/jquery.flexslider-min.js"></script>

    

    <!-- MAIN JS -->
    <script src="https://joseabell.com/theme/js/main.js"></script>
    <script id="dsq-count-scr" src="//joseabell.disqus.com/count.js" async></script>
    
    </body>
</html>
