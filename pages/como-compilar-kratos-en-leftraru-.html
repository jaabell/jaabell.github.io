
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Como compilar kratos en leftraru</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="" />
        <meta name="author" content="Jose Abell" />

    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/css/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/css/flexslider.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/css/style.css">
    <!-- Custom style  -->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/css/custom.css">
    <!-- pygments code highlight -->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/css/pygments.css">
    <!-- tipue search -->
    <link rel="stylesheet" href="http://www.joseabell.com/theme/tipuesearch/css/tipuesearch.css">

    <!-- Modernizr JS -->
    <script src="http://www.joseabell.com/theme/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="/theme/js/respond.min.js"></script>
    <![endif]-->
        <link href="http://www.joseabell.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jose Abells Reasearch Blog Atom">



    </head>
    <body>
    <div id="fh5co-page">
        <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
        <aside id="fh5co-aside" role="complementary" class="border js-fullheight">

            <nav class="fh5co-main-menu" role="navigation">
            </nav>
            <div class="clearfix"></div>
            <h1  id="fh5co-logo">
                <a href="http://www.joseabell.com/index.html">
                    <img src="images/sitelogo.svg" />
                </a>
            </h1>
            <nav class="fh5co-main-menu" role="navigation">
<ul>
    <!-- home link -->
    <li><a href="http://www.joseabell.com/">Home</a></li>

    <!-- page links -->
            <li><a href="http://www.joseabell.com/pages/01about.html">About</a></li>
            <li><a href="http://www.joseabell.com/pages/02research.html">Research</a></li>
            <li><a href="http://www.joseabell.com/pages/03teaching.html">Teaching</a></li>
            <li><a href="http://www.joseabell.com/pages/04publications.html">Publications</a></li>
            <li><a href="http://www.joseabell.com/pages/05tools.html">Tools</a></li>
            <li><a href="http://www.joseabell.com/pages/06cv.html">CV</a></li>
            <li><a href="http://www.joseabell.com/pages/07links.html">Links</a></li>
            <li><a href="http://www.joseabell.com/pages/08prospective-students.html">Prospective Students</a></li>

    <!-- categories -->
        <li><a href="http://www.joseabell.com/categories.html">Categories</a></li>

    <!-- tags -->
        <li><a href="http://www.joseabell.com/tags.html">Tags</a></li>

    <!-- additional menu items from config -->
        <!-- <li class="nav-title">Misc</li> -->
            <li><a href="http://www.joseabell.com/archives.html">Archive</a></li>

</ul><ul><li><form id="searchform" action="http://www.joseabell.com/search.html">
    <input id="tipue_search_input" data-siteurl="http://www.joseabell.com" type="text" size="60" class="form-control search-field" name="q">

    <button type="submit" class="btn btn-primary search-submit"><i class="icon-search4"></i></button>
</form></li></ul>
            </nav>

<ul id="social">
            <li><a href="https://www.github.com/jaabell" alt="Github"><i class="icon-github"></i></a></li>

            <li><a href="https://www.twitter.com/jose_abell" alt="Twitter"><i class="icon-twitter2"></i></a></li>

            <li><a href="https://www.instagram.com/ja.abell" alt="Instagram"><i class="icon-instagram"></i></a></li>

</ul>
        </aside>

        <div id="fh5co-main">

    <div class="fh5co-narrow-content page-content">
        <h1 class="fh5co-heading-colored"><i class=""></i> Como compilar kratos en leftraru</h1>
        <div class="animate-box" data-animate-effect="fadeInLeft">
            <!-- <p class="fh5co-lead animate-box" data-animate-effect="fadeInLeft"></p> -->
            <p class="animate-box " data-animate-effect="fadeInLeft"><h1>Como compilar kratos en leftraru</h1>
<p>Resumen: <em>hay que compilar todo a mano</em></p>
<h2>Cargar modulos necesarios:</h2>
<div class="highlight"><pre><span></span><span class="err">module load intel/2018c       </span>
<span class="err">module load impi/2018.2.199   </span>
<span class="err">module load metis/5.1.0</span>
</pre></div>


<h2>Descargar dependencias:</h2>
<p>Necesitamos descargar y compilar a mano las siguientes librerias</p>
<ul>
<li>zlib</li>
<li>Python3</li>
<li>Trilinos</li>
<li>Boost</li>
<li>Kratos</li>
</ul>
<p>Bajarlas usando:</p>
<div class="highlight"><pre><span></span><span class="err">wget https://zlib.net/zlib-1.2.11.tar.gz</span>
<span class="err">wget https://www.python.org/ftp/python/3.5.5/Python-3.5.5.tgz</span>
<span class="err">wget http://trilinos.csbsju.edu/download/files/trilinos-12.12.1-Source.tar.gz</span>
<span class="err">wget https://sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz</span>
<span class="err">git clone https://github.com/KratosMultiphysics/Kratos.git</span>
</pre></div>


<p>Descomprimir dependencias:</p>
<div class="highlight"><pre><span></span><span class="err">tar -xzvf zlib-1.2.11.tar.gz</span>
<span class="err">tar -xzvf Python-3.5.5.tgz</span>
<span class="err">tar -xzvf trilinos-12.12.1-Source.tar.gz</span>
<span class="err">tar -xzvf boost_1_59_0.tar.gz</span>
</pre></div>


<h2>Compilar zlib</h2>
<div class="highlight"><pre><span></span><span class="err">cd zlib-1.2.11</span>
<span class="err">export CC=icc</span>
<span class="err">export CFLAGS=&#39;-O3 -xHost -ip&#39;</span>
<span class="err">./configure --prefix=$HOME</span>
<span class="err">make -j 20</span>
<span class="err">make install</span>
</pre></div>


<p>Una vez listo, deberiamos tener las librerias compiladas en <code>$HOME</code>.</p>
<div class="highlight"><pre><span></span><span class="err">ls $HOME/lib/libz*</span>
</pre></div>


<p>Entrega algo como:</p>
<div class="highlight"><pre><span></span><span class="err">/home/jabell/lib/libz.a  /home/jabell/lib/libz.so  /home/jabell/lib/libz.so.1  /home/jabell/lib/libz.so.1.2.11</span>
</pre></div>


<p>Volver al home </p>
<div class="highlight"><pre><span></span><span class="err">cd ~</span>
</pre></div>


<h2>Compilar python3</h2>
<p>Compilar e instalar</p>
<div class="highlight"><pre><span></span><span class="err">cd Python-3.5.5</span>
<span class="err">./configure --with-icc --without-gcc --prefix=$HOME --enable-shared</span>
<span class="err">make -j 20</span>
<span class="err">make install</span>
</pre></div>


<p>Hacer un link simbolico para que no se maree trilinos</p>
<div class="highlight"><pre><span></span><span class="err">cd ~/include</span>
<span class="err">ln -s python3.5m/ python3.5</span>
<span class="err">cd ..</span>
</pre></div>


<h2>Compilar boost</h2>
<p>Esto es cacho. Tener paciencia, como dice el compilador a cada rato...</p>
<div class="highlight"><pre><span></span><span class="err">cd boost_1_59_0</span>
<span class="err">./bootstrap.sh  --with-python-version=3.5 --with-libraries=python,mpi,serialization --with-toolset=intel-linux --with-python=$HOME/bin/python3.5m --with-python-root=$HOME/</span>
</pre></div>


<p>Editar <code>project-config.jam</code> usando nano</p>
<div class="highlight"><pre><span></span><span class="err">nano project-config.jam</span>
</pre></div>


<p>Al final del archivo agregar la linea:</p>
<div class="highlight"><pre><span></span><span class="err">using mpi : /home/apps/intel/2018/compilers_and_libraries_2018.2.199/linux/mpi_2019/intel64/bin/mpicc ;</span>
</pre></div>


<p>Luego llamar el compilado:</p>
<div class="highlight"><pre><span></span><span class="err">./b2 stage --with-python --with-serialization --with-mpi variant=release cxxflags=&quot;-std=c++11&quot; link=shared address-model=64 toolset=intel </span>
<span class="err">./b2 install --prefix=$HOME</span>
<span class="err">cd ..</span>
</pre></div>


<h2>Compilar Trilinos</h2>
<p>En este se usa CMAKE</p>
<div class="highlight"><pre><span></span><span class="err">cd trilinos-12.12.1-Source</span>
<span class="err">mkdir build</span>
</pre></div>


<p>Crear <code>do_configure.sh</code> estos eran los contenidos del mio:</p>
<div class="highlight"><pre><span></span>TRILINOS_ROOT=&quot;<span class="cp">${</span><span class="n">HOME</span><span class="cp">}</span>/trilinos-12.12.1-Source&quot;
EXTRA_LINK_FLAGS=&quot;&quot;
EXTRA_ARGS=$@
MPI_ROOT=&quot;<span class="cp">${</span><span class="n">MPI_ROOT</span><span class="cp">}</span>&quot;
METIS_ROOT=&quot;/home/apps/parmetis/4.0.3/&quot;
LAPACK_ROOT=&quot;<span class="cp">${</span><span class="n">MKLROOT</span><span class="cp">}</span>/lib/intel64&quot;

echo &quot;TRILINOS_ROOT = <span class="nv">$TRILINOS_ROOT</span>&quot;
echo &quot;EXTRA_LINK_FLAGS = <span class="nv">$EXTRA_LINK_FLAGS</span>&quot;
echo &quot;EXTRA_ARGS = <span class="nv">$EXTRA_ARGS</span>&quot;
echo &quot;MPI_ROOT = <span class="nv">$MPI_ROOT</span>&quot;
echo &quot;METIS_ROOT = <span class="nv">$METIS_ROOT</span>&quot;
echo &quot;LAPACK_ROOT = <span class="nv">$LAPACK_ROOT</span>&quot;

rm CMakeCache.txt
rm -rf CMakeFiles
rm *.cmake


module load intel/2018c       
module load boost/1.59        
module load python/3.5.2      
module load parmetis/4.0.3
module load impi/2018.2.199   
module load llvm/3.8.1        
module load metis/5.1.0


cmake \
  -DCMAKE_INSTALL_PREFIX:FILEPATH=&quot;<span class="cp">${</span><span class="n">TRILINOS_ROOT</span><span class="cp">}</span>&quot; \
  -DCMAKE_BUILD_TYPE:STRING=RELEASE \
  -DTrilinos_SOURCE_DIR=&quot;<span class="cp">${</span><span class="n">TRILINOS_SOURCE</span><span class="cp">}</span>&quot; \
  -DCMAKE_CXX_COMPILER=icpc \
  -DCMAKE_C_COMPILER=icc \
  -DCMAKE_Fortran_COMPILER=ifort \
  -DTPL_ENABLE_MPI:BOOL=ON \
  -DTrilinos_ENABLE_CXX11=ON\
  -DMPI_BASE_DIR=&quot;<span class="cp">${</span><span class="n">MPI_ROOT</span><span class="cp">}</span>&quot; \
  -DMPI_INCLUDE_DIRS:PATH=&quot;<span class="cp">${</span><span class="n">MPI_ROOT</span><span class="cp">}</span>/include&quot; \
  -DBUILD_SHARED_LIBS:BOOL=ON \
  -DBLAS_LIBRARY_DIRS:FILEPATH=&quot;<span class="cp">${</span><span class="n">MKLROOT</span><span class="cp">}</span>/lib/intel64&quot; \
  -DBLAS_LIBRARY_NAMES:STRING=&quot;mkl_rt&quot; \
  -DLAPACK_LIBRARY_DIRS:FILEPATH=&quot;<span class="cp">${</span><span class="n">MKLROOT</span><span class="cp">}</span>/lib/intel64&quot; \
  -DLAPACK_LIBRARY_NAMES:STRING=&quot;mkl_rt&quot; \
  -DTPL_ENABLE_MKL:BOOL=ON \
  -DMKL_LIBRARY_DIRS:FILEPATH=&quot;<span class="cp">${</span><span class="n">MKLROOT</span><span class="cp">}</span>/lib/intel64&quot; \
  -DMKL_LIBRARY_NAMES:STRING=&quot;mkl_rt&quot; \
  -DMKL_INCLUDE_DIRS:FILEPATH=&quot;<span class="cp">${</span><span class="n">MKLROOT</span><span class="cp">}</span>/include&quot; \
  -DTPL_ENABLE_ParMETIS:BOOL=ON \
  -DParMETIS_INCLUDE_DIRS:PATH=&quot;<span class="cp">${</span><span class="n">METIS_ROOT</span><span class="cp">}</span>/include&quot; \
  -DParMETIS_LIBRARY_NAMES:STRING=&quot;parmetis&quot; \
  -DParMETIS_LIBRARY_DIRS:PATH=&quot;<span class="cp">${</span><span class="n">METIS_ROOT</span><span class="cp">}</span>/lib&quot; \
  -DTPL_ENABLE_METIS:BOOL=ON \
  -DMETIS_INCLUDE_DIRS:PATH=&quot;<span class="cp">${</span><span class="n">METIS_ROOT</span><span class="cp">}</span>/include&quot; \
  -DMETIS_LIBRARY_NAMES:STRING=&quot;metis&quot; \
  -DMETIS_LIBRARY_DIRS:PATH=&quot;<span class="cp">${</span><span class="n">METIS_ROOT</span><span class="cp">}</span>/lib&quot; \
  -DTrilinos_EXTRA_LINK_FLAGS:STRING=&quot;<span class="nv">$EXTRA_LINK_FLAGS</span>&quot; \
  -DTrilinos_ENABLE_Amesos:BOOL=ON \
  -DAmesos_ENABLE_SuperLUDist:BOOL=OFF \
  -DTrilinos_ENABLE_Anasazi:BOOL=ON \
  -DTrilinos_ENABLE_AztecOO:BOOL=ON \
  -DAztecOO_ENABLE_Teuchos:BOOL=ON \
  -DTrilinos_ENABLE_Didasko:BOOL=ON \
  -DTrilinos_ENABLE_Epetra:BOOL=ON \
  -DTrilinos_ENABLE_EpetraExt:BOOL=ON \
  -DTrilinos_ENABLE_Galeri:BOOL=ON \
  -DTrilinos_ENABLE_Ifpack:BOOL=ON \
  -DTrilinos_ENABLE_ML:BOOL=ON \
  -DTrilinos_ENABLE_PyTrilinos:BOOL=OFF \
  -DTrilinos_ENABLE_Teuchos:BOOL=ON \
  -DTrilinos_ENABLE_Triutils:BOOL=ON \
  -DDART_TESTING_TIMEOUT:STRING=600 \
  -DCMAKE_Fortran_FLAGS:STRING=&quot;-O5 -funroll-all-loops -fPIC&quot; \
  -DCMAKE_C_FLAGS:STRING=&quot;-O3 -fPIC -funroll-loops -march=native&quot; \
  -DCMAKE_CXX_FLAGS:STRING=&quot;-O3 -fPIC -funroll-loops -ffast-math -march=native -DMPICH_IGNORE_CXX_SEEK&quot; \
  <span class="nv">$EXTRA_ARGS</span> \
  <span class="cp">${</span><span class="n">TRILINOS_SOURCE</span><span class="cp">}</span> ..
</pre></div>


<p>Preparar compilado</p>
<div class="highlight"><pre><span></span><span class="err">sh do_configure.sh</span>
<span class="err">make -j 20</span>
</pre></div>


<p>TENER MUCHA PACIENCIA</p>
<div class="highlight"><pre><span></span><span class="err">cd ..</span>
</pre></div>


<h2>Compilar Kratos</h2>
<div class="highlight"><pre><span></span><span class="err">cd Kratos</span>
</pre></div>


<p>Descargar <code>tetgen</code></p>
<div class="highlight"><pre><span></span><span class="err">cd applications/PfemApplication/external_modules/</span>
<span class="err">git clone https://github.com/ufz/tetgen.git</span>
<span class="err">cd ../../../</span>
</pre></div>


<p>Preparar configuracion</p>
<div class="highlight"><pre><span></span><span class="err">mkdir build</span>
<span class="err">cd build</span>
<span class="err">nano conf.sh</span>
</pre></div>


<p>Este es mi archivo <code>conf.sh</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="c1"># this is an example file...please DO NOT MODIFY if you don&#39;t want to do it for everyone</span>
<span class="c1">#to use it, copy it to another file and run it</span>

<span class="c1"># additional compiler flags could be added customizing the corresponding var, for example</span>
<span class="c1"># -DCMAKE_CXX_FLAGS=&quot;${CMAKE_CXX_FLAGS} -msse3 &quot;. Note that the &quot;defaults are already correctly coded&quot;</span>
<span class="c1">#so we should ass here only machine specific stuff</span>

<span class="c1">#an effort is made to autodetect all of the libraries needed HOWEVER:</span>
<span class="c1">#METIS_APPLICATION needs the var PARMETIS_ROOT_DIR to be specified by the user (not needed if the app is set to OFF)</span>
<span class="c1">#TRILINOS_APPLICATION needs the var PARMETIS_ROOT_DIR to be specified by the user (not needed if the app is set to OFF)</span>
<span class="c1">#MKL_SOLVERS_APPLICATION needs the var MKLSOLVER_INCLUDE_DIR and MKLSOLVER_LIB_DIR to be specified by the user (not needed if the app is set to OFF)</span>
<span class="c1">#note that the MKLSOLVER_LIB_DIR should include /lib/em64t. This is needed as intel is changing location of mkl at every update of the compiler!!</span>

<span class="c1">#the user should also note that the symbol &quot;\&quot; marks that the command continues on the next line. IT SHOULD ONLY BE FOLLOWED</span>
<span class="c1">#BY the &quot;ENTER&quot; and NOT by any space!!</span>

clear

module load intel/2018c            
module load impi/2018.2.199   
module load metis/5.1.0

<span class="c1">#you may want to decomment this the first time you compile</span>
rm CMakeCache.txt
rm *.cmake
rm -rf CMakeFiles<span class="se">\</span>

cmake ..                                                              <span class="se">\</span>
    -DCMAKE_C_COMPILER<span class="o">=</span>icc                                                <span class="se">\</span>
    -DCMAKE_INSTALL_RPATH_USE_LINK_PATH<span class="o">=</span>TRUE                              <span class="se">\</span>
    -DCMAKE_INSTALL_RPATH<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/Kratos/libs&quot;</span>                      <span class="se">\</span>
    -DCMAKE_CXX_COMPILER<span class="o">=</span>icpc                                             <span class="se">\</span>
    -DCMAKE_CXX_FLAGS<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -msse3 -std=c++11 &quot;</span>             <span class="se">\</span>
    -DCMAKE_C_FLAGS<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMAKE_C_FLAGS</span><span class="si">}</span><span class="s2"> -msse3 &quot;</span>                            <span class="se">\</span>
    -DBOOST_ROOT<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/&quot;</span>                             <span class="se">\</span>
    -DPYTHON_LIBRARY<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/lib/libpython3.5m.so&quot;</span>        <span class="se">\</span>
    -DPYTHON_INCLUDE_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/include/python3.5m&quot;</span>                <span class="se">\</span>
    -DCMAKE_BUILD_TYPE<span class="o">=</span>Release                                            <span class="se">\</span>
    -DCONSTITUTIVE_MODELS_APPLICATION<span class="o">=</span>ON                                  <span class="se">\</span>
    -DFLUID_DYNAMICS_APPLICATION<span class="o">=</span>ON                                       <span class="se">\</span>
    -DCONVECTION_DIFFUSION_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DDEM_APPLICATION<span class="o">=</span>ON                                                  <span class="se">\</span>
    -DSWIMMING_DEM_APPLICATION<span class="o">=</span>OFF                                        <span class="se">\</span>
    -DINCOMPRESSIBLE_FLUID_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DMESHING_APPLICATION<span class="o">=</span>ON                                              <span class="se">\</span>
    -DEXTERNAL_SOLVERS_APPLICATION<span class="o">=</span>ON                                     <span class="se">\</span>
    -DSTRUCTURAL_APPLICATION<span class="o">=</span>ON                                           <span class="se">\</span>
    -DSTRUCTURAL_MECHANICS_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DALE_APPLICATION<span class="o">=</span>ON                                                  <span class="se">\</span>
    -DFSI_APPLICATION<span class="o">=</span>ON                                                  <span class="se">\</span>
    -DMAPPING_APPLICATION<span class="o">=</span>OFF                                             <span class="se">\</span>
    -DOPENCL_APPLICATION<span class="o">=</span>OFF                                              <span class="se">\</span>
    -DMIXED_ELEMENT_APPLICATION<span class="o">=</span>ON                                        <span class="se">\</span>
    -DINSTALL_EMBEDDED_PYTHON<span class="o">=</span>ON                                          <span class="se">\</span>
    -DSHAPE_OPTIMIZATION_APPLICATION<span class="o">=</span>ON                                   <span class="se">\</span>
    -DTOPOLOGY_OPTIMIZATION_APPLICATION<span class="o">=</span>OFF                               <span class="se">\</span>
    -DPFEM_APPLICATION<span class="o">=</span>ON                                                 <span class="se">\</span>
    -DPFEM_FLUID_DYNAMICS_APPLICATION<span class="o">=</span>ON                                  <span class="se">\</span>
    -DCONTACT_MECHANICS_APPLICATION<span class="o">=</span>ON                                    <span class="se">\</span>
    -DSOLID_MECHANICS_APPLICATION<span class="o">=</span>ON                                      <span class="se">\</span>
    -DPFEM_SOLID_MECHANICS_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DPARTICLE_MECHANICS_APPLICATION<span class="o">=</span>ON                                   <span class="se">\</span>
    -DUMAT_APPLICATION<span class="o">=</span>ON                                                 <span class="se">\</span>
    -DMETIS_APPLICATION<span class="o">=</span>ON                                                <span class="se">\</span>
    -DMETIS_INCLUDE_DIR<span class="o">=</span><span class="s2">&quot;/home/apps/metis/5.1.0/include&quot;</span>               <span class="se">\</span>
    -DMETIS_ROOT_DIR<span class="o">=</span><span class="s2">&quot;/home/apps/metis/5.1.0/&quot;</span>               <span class="se">\</span>
    -DUSE_METIS_5<span class="o">=</span>ON                                                      <span class="se">\</span>
    -DTRILINOS_APPLICATION<span class="o">=</span>ON                                             <span class="se">\</span>
    -DTRILINOS_LIBRARY_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/trilinos-12.12.1-Source/lib&quot;</span>     <span class="se">\</span>
    -DTRILINOS_INCLUDE_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/trilinos-12.12.1-Source/include&quot;</span> <span class="se">\</span>
    -DCONVECTION_DIFFUSION_APPLICATION<span class="o">=</span>ON                                 <span class="se">\</span>
    -DEXTERNAL_SOLVERS_APPLICATION<span class="o">=</span>ON                                     <span class="se">\</span>
    -DSOLID_MECHANICS_APPLICATION<span class="o">=</span>ON                                      <span class="se">\</span>
    -DZLIB_LIBRARY<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/lib/libz.so&quot;</span>                                      <span class="se">\</span>
    -DPOROMECHANICS_APPLICATION<span class="o">=</span>ON
</pre></div>
</td></tr></table>

<p>Luego configurar, compilar e instalar</p>
<div class="highlight"><pre><span></span><span class="err">sh conf.sh</span>
<span class="err">make -j 20</span>
<span class="err">make install</span>
</pre></div>


<p>Irse a caminar un rato o practicar los trucos de magia...</p>
<p>Al instalar, si sale un error parecido a:</p>
<div class="highlight"><pre><span></span><span class="err">CMake Error at cmake_install.cmake:69 (FILE):</span>
<span class="err">   file INSTALL cannot find &quot;/home/jabell/Kratos/-lm&quot;.</span>
</pre></div>


<p>Editar <code>cmake_install.sh</code></p>
<div class="highlight"><pre><span></span><span class="err">nano cmake_install.sh</span>
</pre></div>


<p>Y quitar (CTRL+K) la linea que dice:</p>
<div class="highlight"><pre><span></span><span class="err">&quot;/home/jabell/Kratos/-lm&quot;</span>
</pre></div>


<p>(Pro tip: busqueda con nano es "CTRL+/" colocar <code>-lm</code>).</p>
<h2>Modificar .bashrc</h2>
<p>Editar <code>.bashrc</code></p>
<div class="highlight"><pre><span></span><span class="err">cd ~</span>
<span class="err">nano .bashrc</span>
</pre></div>


<p>Agregar las siguientes lineas al final del <code>.bashrc</code></p>
<div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="err">$</span><span class="n">PATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">Kratos</span><span class="o">/</span>
<span class="n">export</span> <span class="n">PYTHONPATH</span><span class="o">=</span><span class="err">$</span><span class="n">PYTHONPATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">Kratos</span><span class="o">/</span>
<span class="n">export</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="err">$</span><span class="n">LD_LIBRARY_PATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">Kratos</span><span class="o">/</span><span class="n">libs</span>
<span class="n">export</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="err">$</span><span class="n">LD_LIBRARY_PATH</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">jabell</span><span class="o">/</span><span class="n">lib</span>


<span class="n">module</span> <span class="k">load</span> <span class="n">parmetis</span><span class="o">/</span><span class="mi">4</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span>
<span class="n">module</span> <span class="k">load</span> <span class="n">metis</span><span class="o">/</span><span class="mi">5</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span>
</pre></div>


<p>Guardar y salirse. Incorporar los cambios al <code>.bashrc</code></p>
<div class="highlight"><pre><span></span><span class="err">source .bashrc</span>
</pre></div>


<h2>PROBAR LA BESTIA!!!</h2>
<p>Crear un archivo <code>testkratos.py</code> en el home</p>
<div class="highlight"><pre><span></span><span class="err">nano testkratos.py</span>
</pre></div>


<p>Poner adentro:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">KratosMultiphysics</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">KratosMultiphysics.mpi</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">KratosMultiphysics.MetisApplication</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">KratosMultiphysics.TrilinosApplication</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>


<p>Guardar y ejecutar</p>
<div class="highlight"><pre><span></span><span class="err">runkratos testkratos.py</span>
</pre></div>


<p>Deberia resultar en </p>
<div class="highlight"><pre><span></span><span class="err"> |  /           |             </span>
<span class="err"> &#39; /   __| _` | __|  _ \   __|</span>
<span class="err"> . \  |   (   | |   (   |\__ \ </span>
<span class="err">_|\_\_|  \__,_|\__|\___/ ____/</span>
<span class="err">           Multi-Physics 6.0.0-4212599</span>
<span class="err">Importing    KratosMetisApplication</span>
<span class="err">Initializing Kratos MetisApplication... </span>
<span class="err">Importing    KratosTrilinosApplication</span>
<span class="err">     KRATOS   _____     _ _ _                 </span>
<span class="err">             |_   _| __(_) (_)_ __   ___  ___ </span>
<span class="err">               | || &#39;__| | | | &#39;_ \ / _ \/ __|</span>
<span class="err">               | || |  | | | | | | | (_) \__ \</span>
<span class="err">               |_||_|  |_|_|_|_| |_|\___/|___/ APPLICATION     </span>
<span class="err">KRATOS TERMINATED CORRECTLY</span>
</pre></div>


<h2>Probar Kratos en el gestor de colas</h2>
<p>Crear un batch script para SLURM (el gestor de colas) llamado <code>testkratos.sh</code> que contenga</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="c1">#SBATCH -n 2  # pedir dos procesos</span>
<span class="c1">#SBATCH -J testkratos</span>
<span class="c1">#SBATCH --time=00:01:00  #Time requested</span>
<span class="c1">#SBATCH --error=testkratos.%A.err</span>
<span class="c1">#SBATCH --output=testkratos.%A.out</span>
<span class="c1">#SBATCH --mail-type=ALL # Type of email notification- BEGIN,END,FAIL,ALL</span>
<span class="c1">#SBATCH --mail-user=ja.abell@gmail.com # Email to which notifications will be sent</span>

srun runkratos testkratos.py
</pre></div>
</td></tr></table>

<p>Este archivo especifica los requerimientos de recursos a leftraru. Debiera ser bastante obvio lo que significa todo. Por siacaso aqui esta la expliacion</p>
<p>Pedir cantidad de procesos</p>
<div class="highlight"><pre><span></span><span class="err">#SBATCH -n 2  # pedir dos procesos</span>
</pre></div>


<p>Hay comandos para solicitar cierto numero de nodos o de proceso por nodo y otras configuraciones. Tambien se pueden correr <code>arreglos</code> o familias de tareas relacionadas usando la opcion <code>array</code>.</p>
<p>Nombre de la tarea </p>
<div class="highlight"><pre><span></span><span class="err">#SBATCH -J testkratos</span>
</pre></div>


<p>Tiempo solicitado.</p>
<div class="highlight"><pre><span></span><span class="err">#SBATCH --time=00:01:00  #Time requested</span>
</pre></div>


<p>La salida del programa, error y standar-out, se redirigen a los archivos especificados por las lineas:</p>
<div class="highlight"><pre><span></span><span class="err">#SBATCH --error=testkratos.%A.err</span>
<span class="err">#SBATCH --output=testkratos.%A.out</span>
</pre></div>


<p>Donde <code>%A</code> se reemplaza por el numero de la tarea. </p>
<p>Para mandar un email con cada cambio de estado de la tarea usar:</p>
<div class="highlight"><pre><span></span><span class="err">#SBATCH --mail-type=ALL # Type of email notification- BEGIN,END,FAIL,ALL</span>
<span class="err">#SBATCH --mail-user=ja.abell@gmail.com # Email to which notifications will be sent</span>
</pre></div>


<p>Finalmente, este es el comando que queremos ejecutar:</p>
<div class="highlight"><pre><span></span><span class="err">srun runkratos testkratos.py</span>
</pre></div>


<p>Pueden haber mas comandos o pasos a seguir. Aqui <code>srun</code> reemplaza la llamada a <code>mpirun</code>.</p>
<p>Ejecutar el script (poner en la cola)</p>
<div class="highlight"><pre><span></span><span class="err">sbatch testkratos.sh</span>
</pre></div>


<p>Deberia decir algo como </p>
<div class="highlight"><pre><span></span><span class="err">Submitted batch job 10894854</span>
</pre></div>


<p>Se puede revisar el status de la tarea solicitada mediante</p>
<div class="highlight"><pre><span></span><span class="err">squeue</span>
</pre></div>


<p>Que dice algo como esto cuanto la tarea esta corriendo </p>
<div class="highlight"><pre><span></span><span class="err">[jabell@leftraru3 ~]$ squeue</span>
<span class="err">             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</span>
<span class="err">          10894854     slims testkrat   jabell PD       0:00      1 (Priority)</span>
</pre></div>


<p>La salida del programa la encontramos en los archivos .err y .out generados. En mi caso, </p>
<div class="highlight"><pre><span></span><span class="err">more testkratos.10894854.4294967294.err</span>
</pre></div>


<p>Resulta vacio, y </p>
<div class="highlight"><pre><span></span><span class="err">more testkratos.10894854.4294967294.out</span>
</pre></div>


<p>resulta en </p>
<div class="highlight"><pre><span></span><span class="err"> |  /           |             </span>
<span class="err"> &#39; /   __| _` | __|  _ \   __|</span>
<span class="err"> . \  |   (   | |   (   |\__ \ </span>
<span class="err">_|\_\_|  \__,_|\__|\___/ ____/</span>
<span class="err">           Multi-Physics 6.0.0-4212599</span>
<span class="err"> |  /           |             </span>
<span class="err"> &#39; /   __| _` | __|  _ \   __|</span>
<span class="err"> . \  |   (   | |   (   |\__ \ </span>
<span class="err">_|\_\_|  \__,_|\__|\___/ ____/</span>
<span class="err">           Multi-Physics 6.0.0-4212599</span>
<span class="err">Initializing Kratos MetisApplication... </span>
<span class="err">Initializing Kratos MetisApplication... </span>
<span class="err">     KRATOS   _____     _ _ _                 </span>
<span class="err">             |_   _| __(_) (_)_ __   ___  ___ </span>
<span class="err">               | || &#39;__| | | | &#39;_ \ / _ \/ __|</span>
<span class="err">               | || |  | | | | | | | (_) \__ \</span>
<span class="err">               |_||_|  |_|_|_|_| |_|\___/|___/ APPLICATION     </span>
<span class="err">Importing    KratosMetisApplication</span>
<span class="err">Importing    KratosTrilinosApplication</span>
<span class="err">KRATOS TERMINATED CORRECTLY</span>
<span class="err">Importing    KratosMetisApplication</span>
<span class="err">Importing    KratosTrilinosApplication</span>
<span class="err">KRATOS TERMINATED CORRECTLY</span>
</pre></div>


<p>Notar que corrieron dos Kratos (pedimos dos procesos). Supongo que hay mas cambios que hay que hacer en los scripts python que queremos correr, pero eso es todo por ahora. </p>
<p><img alt="Arrivederci" src="https://i.gifer.com/4xw2.gif"></p></p>
        </div>
    </div>


<div class="fh5co-footer">
    <p><small>&copy; 2016 Blend Free HTML5. All Rights Reserved.</span> <span>Designed by <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a></span>
    <br /><span>Pelican Theme by: <a href="https://github.com/claudio-walser/pelican-fh5co-marble" target="_blank">Claudio Walser</a></span></small></p>

</div>                
        </div>
    </div>

    <!-- jQuery -->
    <script src="http://www.joseabell.com/theme/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="http://www.joseabell.com/theme/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="http://www.joseabell.com/theme/js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="http://www.joseabell.com/theme/js/jquery.waypoints.min.js"></script>
    <!-- Flexslider -->
    <script src="http://www.joseabell.com/theme/js/jquery.flexslider-min.js"></script>


    <!-- MAIN JS -->
    <script src="http://www.joseabell.com/theme/js/main.js"></script>
    </body>
</html>
