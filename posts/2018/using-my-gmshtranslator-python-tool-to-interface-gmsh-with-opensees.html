
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using my gmshtranslator python tool to interface gmsh with opensees.</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="jaabell" />
    <meta name="description" content="I wrote the gmshtranslator tool a while back during my …" />
    <meta name="keywords" content="OpenSees, gmsh, gmshtranslator, python, pre-proceesing, meshing">
<!-- Facebook and Twitter integration -->
<meta property="og:site_name" content="Jose Abells Reasearch Blog"/>
<meta property="og:title" content="Using my gmshtranslator python tool to interface gmsh with opensees."/>
<meta property="og:description" content="I wrote the gmshtranslator tool a while back during my …"/>
<meta property="og:url" content="https://joseabell.com/posts/2018/using-my-gmshtranslator-python-tool-to-interface-gmsh-with-opensees.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-02-26 13:55:13-08:00"/>
<meta property="article:modified_time" content="2018-02-26 13:55:13-08:00"/>
<meta property="article:author" content="https://joseabell.com/author/jaabell.html">
<meta property="article:section" content="Tutorials"/>
    <meta property="article:tag" content="OpenSees"/>
    <meta property="article:tag" content="gmsh"/>
    <meta property="article:tag" content="gmshtranslator"/>
    <meta property="article:tag" content="python"/>
    <meta property="article:tag" content="pre-proceesing"/>
    <meta property="article:tag" content="meshing"/>
    <meta property="og:image" content="https://joseabell.com/https://www.dropbox.com/s/24tkmfk1y1r0wz5/disp.png?raw=1">

    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/bootstrap.css">
    <!-- Flexslider  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/flexslider.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/style.css">
    <!-- Custom style  -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/custom.css">
    <!-- pygments code highlight -->
    <link rel="stylesheet" href="https://joseabell.com/theme/css/pygments.css">
    <!-- tipue search -->
    <link rel="stylesheet" href="https://joseabell.com/theme/tipuesearch/css/tipuesearch.css">
    <!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" > -->
    <script src="https://kit.fontawesome.com/2dfe6f2f70.js" crossorigin="anonymous"></script>


    <!-- Modernizr JS -->
    <script src="https://joseabell.com/theme/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="/theme/js/respond.min.js"></script>
    <![endif]-->
        <link href="https://joseabell.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jose Abells Reasearch Blog Atom">




    </head>
    <body>
    <!-- Uncomment for fun -->
    <!-- <marquee bgcolor="red" height="50px" style="color:yellow;font-size:30px;"> OMG COVID--19 ALERT TAKE COVER ALL!!! </marquee> -->
    <div id="fh5co-page">
        <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
        <aside id="fh5co-aside" role="complementary" class="border js-fullheight">


            <nav class="fh5co-main-menu" role="navigation">
            </nav>


            
            <div class="clearfix"></div>
            <h1  id="fh5co-logo">
                <a href="https://joseabell.com/index.html">
                    <img src="/images/sitelogo.svg" />
                </a>
            </h1>


            <nav class="fh5co-main-menu" role="navigation">

<ul>
    <!-- home link -->
    <li><a href="https://joseabell.com/">Home</a></li>

    <!-- page links -->
            <li><a href="https://joseabell.com/pages/01about.html">About</a></li>
            <li><a href="https://joseabell.com/pages/04publications.html">Publications</a></li>
            <li><a href="https://joseabell.com/pages/05tools.html">Tools</a></li>

    <!-- categories -->
        <li><a href="https://joseabell.com/categories.html">Categories</a></li>

    <!-- tags -->
        <li><a href="https://joseabell.com/tags.html">Tags</a></li>

    <!-- additional menu items from config -->

</ul><!--                 <ul><li><form id="searchform" action="https://joseabell.com/search.html">
    <input id="tipue_search_input" data-siteurl="https://joseabell.com" type="text" size="60" class="form-control search-field" name="q">

    <button type="submit" class="btn btn-primary search-submit"><i class="icon-search4"></i></button>
</form></li></ul> -->



<ul id="social"><li>
            <li><a href="https://www.github.com/jaabell" alt="Github"><i class="fab fa-github fa-2x"></i></a></li>
            <li><a href="https://www.youtube.com/c/JoseAAbellM" alt="Youtube"><i class="fab fa-youtube fa-2x"></i></a></li>

            <li><a href="https://www.researchgate.net/profile/Jose_Abell/" alt="researchgate"><i class="fab fa-researchgate fa-2x"></i></a></li>

            <li><a href="linkedin.com/in/josé-abell-93194129" alt="linkedin"><i class="fab fa-linkedin fa-2x"></i></a></li>


</li>
</ul>            
            <ul id="map">
                <li>
                Visitors come from
                <script type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?cl=b3b3b3&w=250&t=n&d=XCjx4HKZp-atwA8u2pe4wbQt9_6FCkYMlpMpnxG6qMU&co=f5f5f5&cmo=027aae&cmn=a03338&ct=808080"></script>
                </li>
            </ul>
            </nav>

        </aside>

        <div id="fh5co-main">

    <div class="fh5co-narrow-content article-content">
        <h1 class="fh5co-heading-colored">Using my gmshtranslator python tool to interface gmsh with opensees.</h1>

        <div>by
                <a href="author/jaabell.html">jaabell</a> - Mon, 26 Feb 2018
        </div>

            <div><span>Tags: </span>
                    <span><a href="https://joseabell.com/tag/opensees.html">#OpenSees</a> </span>
                    <span><a href="https://joseabell.com/tag/gmsh.html">#gmsh</a> </span>
                    <span><a href="https://joseabell.com/tag/gmshtranslator.html">#gmshtranslator</a> </span>
                    <span><a href="https://joseabell.com/tag/python.html">#python</a> </span>
                    <span><a href="https://joseabell.com/tag/pre-proceesing.html">#pre-proceesing</a> </span>
                    <span><a href="https://joseabell.com/tag/meshing.html">#meshing</a> </span>
            </div>

        <div class="animate-box" data-animate-effect="fadeInLeft">
            <p class="animate-box" data-animate-effect="fadeInLeft"><!-- SUMMARY BEGIN -->

<p>I wrote the <a href="https://github.com/jaabell/gmshtranslator"><em>gmshtranslator</em></a> tool a while back during my PhD, to easily parse <a href="http://gmsh.info/"><em>gmsh</em></a> <code>msh</code> files to any other format. I've been using it for years now with not much change for both research and consulting, and have been contacted by other researchers that want to use it. I will soon write a tool, powered by <em>gmshtranslator</em>, to more easily translate from <em>gmsh</em> into OpenSees. Meanwhile, here is a short example on how to use gmshtranslator to create <a href="opensees.berkeley.edu"><em>OpenSees</em></a> models. The example assumes you know <em>gmsh</em> formats (<code>.geo</code> and <code>.msh</code>) and python. </p>
<p>The example consists on the simple cantilever beam shown in the following figure.</p>
<!-- SUMMARY END -->

<p><img src="https://www.dropbox.com/s/96dqfc5r6su4pjd/beam.png?raw=1" /></p>
<p>The beam is fixed at the right end, and has node-by-node forcing on the right end. The following <em>gmsh</em> <code>.geo.</code> script prepares the domain. </p>
<p><strong><code>beam.geo :</code></strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">LX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">LY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w"> </span><span class="n">Nx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">;</span><span class="w"> </span><span class="n">Ny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">LX</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="n">Point</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">LX</span><span class="p">,</span><span class="w"> </span><span class="n">LY</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="n">Point</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">LY</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="n">Line</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span><span class="w"></span>
<span class="n">Line</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span><span class="w"></span>
<span class="n">Line</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">};</span><span class="w"></span>
<span class="n">Line</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="n">Line</span><span class="w"> </span><span class="nf">Loop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">};</span><span class="w"></span>
<span class="n">Plane</span><span class="w"> </span><span class="nf">Surface</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>

<span class="n">Transfinite</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nx</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">Transfinite</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ny</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">Transfinite</span><span class="w"> </span><span class="n">Surface</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="n">Recombine</span><span class="w"> </span><span class="n">Surface</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>

<span class="n">Physical</span><span class="w"> </span><span class="nf">Line</span><span class="p">(</span><span class="s">&quot;Fixed&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">4</span><span class="p">};</span><span class="w"></span>
<span class="n">Physical</span><span class="w"> </span><span class="nf">Line</span><span class="p">(</span><span class="s">&quot;Forcing&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">};</span><span class="w"></span>
<span class="n">Physical</span><span class="w"> </span><span class="nf">Surface</span><span class="p">(</span><span class="s">&quot;Beam&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>

<span class="n">Mesh</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>3 physical groups are defined: <em>fixed</em> to identify the fixed nodes, <em>forcing</em> to identify the nodes that will carry loads, and <em>beam</em> contains all the quad elements to represent the body of the beam. Note the optional use of the transfinite meshing algorithm. Once this script is executed in <em>gmsh</em> the <code>.msh</code> file can be exported. The resulting <code>.msh</code> file can be found <a href="https://www.dropbox.com/s/3d44h0ttdrm67gz/beam.msh?dl=0">here</a>. </p>
<p><em>gmshtranslator</em> parses the <code>.msh</code> file, executing code depending on certain user-defined rules. What we want to do is define an opensees node command for each node in the <code>.msh</code> file, fix the nodes contained in the <em>fixed</em> physical group, generate forces for the nodes in the <em>forcing</em> physical group, and add quad elements for each quad in the <code>.msh</code> file. </p>
<p>First, import the <code>beam.msh</code> file into <em>gmshtranslator</em> and open files to be written that will contain the opensees code. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">gmshtranslator</span> <span class="kn">import</span> <span class="n">gmshTranslator</span>

<span class="n">mshfname</span> <span class="o">=</span> <span class="s2">&quot;beam.msh&quot;</span>

<span class="n">gt</span> <span class="o">=</span> <span class="n">gmshTranslator</span><span class="p">(</span><span class="n">mshfname</span><span class="p">)</span>

<span class="n">fid_nodes</span> <span class="o">=</span>    <span class="nb">open</span><span class="p">(</span><span class="n">mshfname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.msh&quot;</span><span class="p">,</span> <span class="s2">&quot;.nodes.tcl&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">fid_elements</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mshfname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.msh&quot;</span><span class="p">,</span> <span class="s2">&quot;.elements.tcl&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">fid_fixities</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mshfname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.msh&quot;</span><span class="p">,</span> <span class="s2">&quot;.fixities.tcl&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">fid_loads</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mshfname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.msh&quot;</span><span class="p">,</span> <span class="s2">&quot;.loads.tcl&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>I like writing different things (nodes, elements, etc.) in separate files for debugging. Your style might be different. <em>gmshtranslator</em> parses the file and evaluates <em>rules</em>. A rule is composed of a <em>condition</em> that must be met and an <em>action</em> to be executed, these are both python functions. There are rules for nodes and for elements. </p>
<p>The syntax for node and element conditions are:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">node_condition</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">physgroups</span><span class="p">):</span> 
<span class="k">def</span> <span class="nf">element_condition</span><span class="p">(</span><span class="n">eletag</span><span class="p">,</span><span class="n">eletype</span><span class="p">,</span><span class="n">physgrp</span><span class="p">,</span><span class="n">nodes</span><span class="p">):</span>
</code></pre></div>
</td></tr></table>
<p>These are functions that evaluate to <code>true</code> or <code>false</code> depending on the inputs. Then the syntax for <em>actions</em> are:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">node_action</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">element_action</span><span class="p">(</span><span class="n">eletag</span><span class="p">,</span><span class="n">eletype</span><span class="p">,</span><span class="n">physgrp</span><span class="p">,</span><span class="n">nodes</span><span class="p">):</span>
</code></pre></div>
</td></tr></table>
<p>These functions don't return anything, instead excecute whatever code should be executed if the <em>condition</em> of the rule is met. Rules are added to the parser by using the <code>add_nodes_rule</code> or <code>add_elements_rule</code> function of <em>gmshtranslator</em> and are excecuted whenever the <code>parse()</code> method is called. </p>
<p>For example, the rule to add all nodes to the opensees domain would be:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_node</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">physgroups</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="n">fid_nodes</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;node </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="n">gt</span><span class="o">.</span><span class="n">add_nodes_rule</span><span class="p">(</span><span class="n">is_node</span><span class="p">,</span> <span class="n">add_node</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>The node <em>condition</em> (<code>is_node</code>) function always returns <code>true</code>, that is this rule will execute for all nodes. The <em>action</em> function is <code>add_node</code> and will write the appropriate text into the nodes file. The <em>rule</em> is added into the parser by using the <code>gt.add_nodes_rule</code> function which accepts two python functions as arguments: a condition and an action. </p>
<p>The code for the rest of the example is:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fix_node</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="n">fid_fixities</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;fix </span><span class="si">{}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">add_load</span><span class="p">(</span><span class="n">eletag</span><span class="p">,</span><span class="n">eletype</span><span class="p">,</span><span class="n">physgrp</span><span class="p">,</span><span class="n">nodes</span><span class="p">):</span>
    <span class="n">fid_loads</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;load </span><span class="si">{}</span><span class="s2"> $fx $fy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">fid_loads</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;load </span><span class="si">{}</span><span class="s2"> $fx $fy</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">add_element</span><span class="p">(</span><span class="n">eletag</span><span class="p">,</span><span class="n">eletype</span><span class="p">,</span><span class="n">physgrp</span><span class="p">,</span><span class="n">nodes</span><span class="p">):</span>
    <span class="n">fid_elements</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;element quad </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> $thick PlaneStress $mat_tag</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eletag</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>


<span class="n">gt</span><span class="o">.</span><span class="n">add_nodes_rule</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">is_node_in</span><span class="p">(</span><span class="s2">&quot;Fixed&quot;</span><span class="p">),</span> <span class="n">fix_node</span><span class="p">)</span>

<span class="n">gt</span><span class="o">.</span><span class="n">add_elements_rule</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">is_element_in</span><span class="p">(</span><span class="s2">&quot;Forcing&quot;</span><span class="p">),</span> <span class="n">add_load</span><span class="p">)</span>
<span class="n">gt</span><span class="o">.</span><span class="n">add_elements_rule</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">is_element_in</span><span class="p">(</span><span class="s2">&quot;Beam&quot;</span><span class="p">),</span> <span class="n">add_element</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>Note that we didn't write a condition for the <code>fix_node</code> action, instead we used some of the simple conditions contained in <em>gmshtranslator</em> that can simplify some typical situations. In this case the <code>gt.is_node_in()</code> function takes a physical group name and evaluates whether each node is in that physical group. An equivalent <code>python</code> code for this would be:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Fixed</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Physical group number assigned by gmsh to the &#39;Fixed&#39; group</span>
<span class="k">def</span> <span class="nf">is_node_in_Fixed</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">physgroups</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Fixed</span> <span class="ow">in</span> <span class="n">physgroups</span>
</code></pre></div>
</td></tr></table>
<p>Or using <em>gmstranslator</em>s internal mapping.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_node_in_Fixed</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">physgroups</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">gt</span><span class="o">.</span><span class="n">physical_groups_by_name</span><span class="p">[</span><span class="s1">&#39;Fixed&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">physgroups</span>\
</code></pre></div>
</td></tr></table>
<p>The same holds true for the <code>add_load</code> and <code>add_element</code> rules, I just opted to use the simple function but could have written a condition function from scratch.  Add all rules to the parser by callig the <code>add_X_rule</code> functions. Finally, call parse to execute and generate all output files. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">gt</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>Don't forget to close files people!</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">fid_nodes</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">fid_elements</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">fid_fixities</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">fid_loads</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>Run the python script and, voillá! Meshing done. </p>
<p>Finally, for completeness, here is the OpenSees tcl code that runs the complete example. I used elastic-isotropic material and a simple static analysis. I added only vertical loading on the tip of the beam. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">model</span><span class="w"> </span>BasicBuilder<span class="w"> </span><span class="o">-</span>ndm<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span>ndf<span class="w"> </span><span class="mi">2</span>

<span class="k">set</span><span class="w"> </span>thick<span class="w"> </span><span class="mf">1.0</span>

<span class="k">set</span><span class="w"> </span>mat_tag<span class="w"> </span><span class="mi">1</span>
<span class="k">set</span><span class="w"> </span>E<span class="w"> </span><span class="mi">200</span>.e9
<span class="k">set</span><span class="w"> </span>nu<span class="w"> </span><span class="mf">0.3</span>

<span class="nv">nDMaterial</span><span class="w"> </span>ElasticIsotropic<span class="w"> </span><span class="nv">$mat_tag</span><span class="w"> </span><span class="nv">$E</span><span class="w"> </span><span class="nv">$nu</span>

<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;beam.nodes.tcl&quot;</span>
<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;beam.fixities.tcl&quot;</span>
<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;beam.elements.tcl&quot;</span>

<span class="k">set</span><span class="w"> </span>tstag<span class="w"> </span><span class="mi">1</span>
<span class="nv">timeSeries</span><span class="w"> </span>Linear<span class="w"> </span><span class="nv">$tstag</span><span class="w"> </span><span class="mf">1.0</span>

<span class="k">set</span><span class="w"> </span>Ly<span class="w"> </span><span class="mf">0.5</span>
<span class="k">set</span><span class="w"> </span>Ny<span class="w"> </span><span class="mi">5</span>
<span class="k">set</span><span class="w"> </span>dy<span class="w"> </span><span class="k">[expr</span><span class="w"> </span><span class="nv">$Ly</span><span class="o">/</span><span class="nv">$Ny</span><span class="k">]</span>

<span class="k">set</span><span class="w"> </span>fx<span class="w"> </span><span class="k">[expr</span><span class="w"> </span><span class="mi">0</span><span class="o">*</span><span class="nv">$dy</span><span class="o">/</span><span class="mi">2</span><span class="k">]</span>
<span class="k">set</span><span class="w"> </span>fy<span class="w"> </span><span class="k">[expr</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span>.<span class="o">*</span><span class="nv">$dy</span><span class="o">/</span><span class="mi">2</span><span class="k">]</span>

<span class="nv">pattern</span><span class="w"> </span>Plain<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="s2">&quot;Linear&quot;</span><span class="w"> </span><span class="k">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;beam.loads.tcl&quot;</span>
<span class="k">}</span>

<span class="nv">recorder</span><span class="w"> </span>pvd<span class="w"> </span>disp<span class="w"> </span>disp

<span class="nv">constraints</span><span class="w"> </span>Plain
<span class="nv">numberer</span><span class="w"> </span>RCM
<span class="nv">system</span><span class="w"> </span>UmfPack
<span class="nv">test</span><span class="w"> </span>NormDispIncr<span class="w"> </span><span class="mf">1.0</span>e-9<span class="w"> </span><span class="mi">10</span>
<span class="nv">algorithm</span><span class="w"> </span>Newton
<span class="nv">integrator</span><span class="w"> </span>LoadControl<span class="w"> </span><span class="mi">1</span>
<span class="nv">analysis</span><span class="w"> </span>Static
<span class="nv">analyze</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>
</td></tr></table>
<p>The <code>pvd</code> recorder is used to generate a nice output file that can be viewed using <a href="https://www.paraview.org/">paraview</a>. </p>
<p><img alt="Deflections" src="https://www.dropbox.com/s/24tkmfk1y1r0wz5/disp.png?raw=1"></p></p>
        </div>
    </div>

<div class="fh5co-narrow-content">
<div class="animate-box" data-animate-effect="fadeInLeft">
    <h2><!-- <i class="icon-speech-bubble"></i>  -->Comments</h2>
</div>
<div class="animate-box" data-animate-effect="fadeInLeft">
    <div id="disqus_thread"></div>
</div>

<!-- <script>
var disqus_config = function () { 
  this.language = "en";
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript><a href="https://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a></noscript> -->

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

// var disqus_config = function () {
// this.page.url = www.joseabell.com;  // Replace PAGE_URL with your page's canonical URL variable
// this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
// };

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://joseabell.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://joseabell.com/theme/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="https://joseabell.com/theme/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="https://joseabell.com/theme/js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="https://joseabell.com/theme/js/jquery.waypoints.min.js"></script>
    <!-- Flexslider -->
    <script src="https://joseabell.com/theme/js/jquery.flexslider-min.js"></script>

    

    <!-- MAIN JS -->
    <script src="https://joseabell.com/theme/js/main.js"></script>
    <script id="dsq-count-scr" src="//joseabell.disqus.com/count.js" async></script>
    
    </body>
</html>
